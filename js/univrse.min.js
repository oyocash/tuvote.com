/**
 * Univrse - v0.2.0
 * A universal schema for serializing data objects, secured with signatures and encryption.
 * https://github.com/libitx/univrse-js
 * Copyright Â© 2022 Chronos Labs Ltd. Apache-2.0 License
 */

var Univrse=function(t,e,r){"use strict";function n(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var i=n(crypto),s="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function u(t){var e={exports:{}};return t(e,e.exports),e.exports}for(var o=function(t){var e=d(t),r=e[0],n=e[1];return 3*(r+n)/4-n},a=function(t){var e,r,n=d(t),i=n[0],s=n[1],u=new p(function(t,e,r){return 3*(e+r)/4-r}(0,i,s)),o=0,a=s>0?i-4:i;for(r=0;r<a;r+=4)e=c[t.charCodeAt(r)]<<18|c[t.charCodeAt(r+1)]<<12|c[t.charCodeAt(r+2)]<<6|c[t.charCodeAt(r+3)],u[o++]=e>>16&255,u[o++]=e>>8&255,u[o++]=255&e;2===s&&(e=c[t.charCodeAt(r)]<<2|c[t.charCodeAt(r+1)]>>4,u[o++]=255&e);1===s&&(e=c[t.charCodeAt(r)]<<10|c[t.charCodeAt(r+1)]<<4|c[t.charCodeAt(r+2)]>>2,u[o++]=e>>8&255,u[o++]=255&e);return u},f=function(t){for(var e,r=t.length,n=r%3,i=[],s=16383,u=0,o=r-n;u<o;u+=s)i.push(m(t,u,u+s>o?o:u+s));1===n?(e=t[r-1],i.push(h[e>>2]+h[e<<4&63]+"==")):2===n&&(e=(t[r-2]<<8)+t[r-1],i.push(h[e>>10]+h[e>>4&63]+h[e<<2&63]+"="));return i.join("")},h=[],c=[],p="undefined"!=typeof Uint8Array?Uint8Array:Array,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",y=0,g=l.length;y<g;++y)h[y]=l[y],c[l.charCodeAt(y)]=y;function d(t){var e=t.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var r=t.indexOf("=");return-1===r&&(r=e),[r,r===e?0:4-r%4]}function m(t,e,r){for(var n,i,s=[],u=e;u<r;u+=3)n=(t[u]<<16&16711680)+(t[u+1]<<8&65280)+(255&t[u+2]),s.push(h[(i=n)>>18&63]+h[i>>12&63]+h[i>>6&63]+h[63&i]);return s.join("")}c["-".charCodeAt(0)]=62,c["_".charCodeAt(0)]=63;var w={byteLength:o,toByteArray:a,fromByteArray:f},b=function(t,e,r,n,i){var s,u,o=8*i-n-1,a=(1<<o)-1,f=a>>1,h=-7,c=r?i-1:0,p=r?-1:1,l=t[e+c];for(c+=p,s=l&(1<<-h)-1,l>>=-h,h+=o;h>0;s=256*s+t[e+c],c+=p,h-=8);for(u=s&(1<<-h)-1,s>>=-h,h+=n;h>0;u=256*u+t[e+c],c+=p,h-=8);if(0===s)s=1-f;else{if(s===a)return u?NaN:1/0*(l?-1:1);u+=Math.pow(2,n),s-=f}return(l?-1:1)*u*Math.pow(2,s-n)},v=function(t,e,r,n,i,s){var u,o,a,f=8*s-i-1,h=(1<<f)-1,c=h>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,l=n?0:s-1,y=n?1:-1,g=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(o=isNaN(e)?1:0,u=h):(u=Math.floor(Math.log(e)/Math.LN2),e*(a=Math.pow(2,-u))<1&&(u--,a*=2),(e+=u+c>=1?p/a:p*Math.pow(2,1-c))*a>=2&&(u++,a/=2),u+c>=h?(o=0,u=h):u+c>=1?(o=(e*a-1)*Math.pow(2,i),u+=c):(o=e*Math.pow(2,c-1)*Math.pow(2,i),u=0));i>=8;t[r+l]=255&o,l+=y,o/=256,i-=8);for(u=u<<i|o,f+=i;f>0;t[r+l]=255&u,l+=y,u/=256,f-=8);t[r+l-y]|=128*g},A=u((function(t,e){var r="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;e.Buffer=s,e.SlowBuffer=function(t){+t!=t&&(t=0);return s.alloc(+t)},e.INSPECT_MAX_BYTES=50;var n=2147483647;function i(t){if(t>n)throw new RangeError('The value "'+t+'" is invalid for option "size"');var e=new Uint8Array(t);return Object.setPrototypeOf(e,s.prototype),e}function s(t,e,r){if("number"==typeof t){if("string"==typeof e)throw new TypeError('The "string" argument must be of type string. Received type number');return a(t)}return u(t,e,r)}function u(t,e,r){if("string"==typeof t)return function(t,e){"string"==typeof e&&""!==e||(e="utf8");if(!s.isEncoding(e))throw new TypeError("Unknown encoding: "+e);var r=0|p(t,e),n=i(r),u=n.write(t,e);u!==r&&(n=n.slice(0,u));return n}(t,e);if(ArrayBuffer.isView(t))return function(t){if(H(t,Uint8Array)){var e=new Uint8Array(t);return h(e.buffer,e.byteOffset,e.byteLength)}return f(t)}(t);if(null==t)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t);if(H(t,ArrayBuffer)||t&&H(t.buffer,ArrayBuffer))return h(t,e,r);if("undefined"!=typeof SharedArrayBuffer&&(H(t,SharedArrayBuffer)||t&&H(t.buffer,SharedArrayBuffer)))return h(t,e,r);if("number"==typeof t)throw new TypeError('The "value" argument must not be of type number. Received type number');var n=t.valueOf&&t.valueOf();if(null!=n&&n!==t)return s.from(n,e,r);var u=function(t){if(s.isBuffer(t)){var e=0|c(t.length),r=i(e);return 0===r.length||t.copy(r,0,0,e),r}if(void 0!==t.length)return"number"!=typeof t.length||G(t.length)?i(0):f(t);if("Buffer"===t.type&&Array.isArray(t.data))return f(t.data)}(t);if(u)return u;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof t[Symbol.toPrimitive])return s.from(t[Symbol.toPrimitive]("string"),e,r);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof t)}function o(t){if("number"!=typeof t)throw new TypeError('"size" argument must be of type number');if(t<0)throw new RangeError('The value "'+t+'" is invalid for option "size"')}function a(t){return o(t),i(t<0?0:0|c(t))}function f(t){for(var e=t.length<0?0:0|c(t.length),r=i(e),n=0;n<e;n+=1)r[n]=255&t[n];return r}function h(t,e,r){if(e<0||t.byteLength<e)throw new RangeError('"offset" is outside of buffer bounds');if(t.byteLength<e+(r||0))throw new RangeError('"length" is outside of buffer bounds');var n;return n=void 0===e&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,e):new Uint8Array(t,e,r),Object.setPrototypeOf(n,s.prototype),n}function c(t){if(t>=n)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+n.toString(16)+" bytes");return 0|t}function p(t,e){if(s.isBuffer(t))return t.length;if(ArrayBuffer.isView(t)||H(t,ArrayBuffer))return t.byteLength;if("string"!=typeof t)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof t);var r=t.length,n=arguments.length>2&&!0===arguments[2];if(!n&&0===r)return 0;for(var i=!1;;)switch(e){case"ascii":case"latin1":case"binary":return r;case"utf8":case"utf-8":return x(t).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*r;case"hex":return r>>>1;case"base64":return D(t).length;default:if(i)return n?-1:x(t).length;e=(""+e).toLowerCase(),i=!0}}function l(t,e,r){var n=!1;if((void 0===e||e<0)&&(e=0),e>this.length)return"";if((void 0===r||r>this.length)&&(r=this.length),r<=0)return"";if((r>>>=0)<=(e>>>=0))return"";for(t||(t="utf8");;)switch(t){case"hex":return O(this,e,r);case"utf8":case"utf-8":return I(this,e,r);case"ascii":return T(this,e,r);case"latin1":case"binary":return U(this,e,r);case"base64":return _(this,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return R(this,e,r);default:if(n)throw new TypeError("Unknown encoding: "+t);t=(t+"").toLowerCase(),n=!0}}function y(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function g(t,e,r,n,i){if(0===t.length)return-1;if("string"==typeof r?(n=r,r=0):r>2147483647?r=2147483647:r<-2147483648&&(r=-2147483648),G(r=+r)&&(r=i?0:t.length-1),r<0&&(r=t.length+r),r>=t.length){if(i)return-1;r=t.length-1}else if(r<0){if(!i)return-1;r=0}if("string"==typeof e&&(e=s.from(e,n)),s.isBuffer(e))return 0===e.length?-1:d(t,e,r,n,i);if("number"==typeof e)return e&=255,"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(t,e,r):Uint8Array.prototype.lastIndexOf.call(t,e,r):d(t,[e],r,n,i);throw new TypeError("val must be string, number or Buffer")}function d(t,e,r,n,i){var s,u=1,o=t.length,a=e.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(t.length<2||e.length<2)return-1;u=2,o/=2,a/=2,r/=2}function f(t,e){return 1===u?t[e]:t.readUInt16BE(e*u)}if(i){var h=-1;for(s=r;s<o;s++)if(f(t,s)===f(e,-1===h?0:s-h)){if(-1===h&&(h=s),s-h+1===a)return h*u}else-1!==h&&(s-=s-h),h=-1}else for(r+a>o&&(r=o-a),s=r;s>=0;s--){for(var c=!0,p=0;p<a;p++)if(f(t,s+p)!==f(e,p)){c=!1;break}if(c)return s}return-1}function m(t,e,r,n){r=Number(r)||0;var i=t.length-r;n?(n=Number(n))>i&&(n=i):n=i;var s=e.length;n>s/2&&(n=s/2);for(var u=0;u<n;++u){var o=parseInt(e.substr(2*u,2),16);if(G(o))return u;t[r+u]=o}return u}function A(t,e,r,n){return j(x(e,t.length-r),t,r,n)}function E(t,e,r,n){return j(function(t){for(var e=[],r=0;r<t.length;++r)e.push(255&t.charCodeAt(r));return e}(e),t,r,n)}function B(t,e,r,n){return j(D(e),t,r,n)}function S(t,e,r,n){return j(function(t,e){for(var r,n,i,s=[],u=0;u<t.length&&!((e-=2)<0);++u)n=(r=t.charCodeAt(u))>>8,i=r%256,s.push(i),s.push(n);return s}(e,t.length-r),t,r,n)}function _(t,e,r){return 0===e&&r===t.length?w.fromByteArray(t):w.fromByteArray(t.slice(e,r))}function I(t,e,r){r=Math.min(t.length,r);for(var n=[],i=e;i<r;){var s,u,o,a,f=t[i],h=null,c=f>239?4:f>223?3:f>191?2:1;if(i+c<=r)switch(c){case 1:f<128&&(h=f);break;case 2:128==(192&(s=t[i+1]))&&(a=(31&f)<<6|63&s)>127&&(h=a);break;case 3:s=t[i+1],u=t[i+2],128==(192&s)&&128==(192&u)&&(a=(15&f)<<12|(63&s)<<6|63&u)>2047&&(a<55296||a>57343)&&(h=a);break;case 4:s=t[i+1],u=t[i+2],o=t[i+3],128==(192&s)&&128==(192&u)&&128==(192&o)&&(a=(15&f)<<18|(63&s)<<12|(63&u)<<6|63&o)>65535&&a<1114112&&(h=a)}null===h?(h=65533,c=1):h>65535&&(h-=65536,n.push(h>>>10&1023|55296),h=56320|1023&h),n.push(h),i+=c}return function(t){var e=t.length;if(e<=N)return String.fromCharCode.apply(String,t);var r="",n=0;for(;n<e;)r+=String.fromCharCode.apply(String,t.slice(n,n+=N));return r}(n)}e.kMaxLength=n,s.TYPED_ARRAY_SUPPORT=function(){try{var t=new Uint8Array(1),e={foo:function(){return 42}};return Object.setPrototypeOf(e,Uint8Array.prototype),Object.setPrototypeOf(t,e),42===t.foo()}catch(t){return!1}}(),s.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(s.prototype,"parent",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.buffer}}),Object.defineProperty(s.prototype,"offset",{enumerable:!0,get:function(){if(s.isBuffer(this))return this.byteOffset}}),s.poolSize=8192,s.from=function(t,e,r){return u(t,e,r)},Object.setPrototypeOf(s.prototype,Uint8Array.prototype),Object.setPrototypeOf(s,Uint8Array),s.alloc=function(t,e,r){return function(t,e,r){return o(t),t<=0?i(t):void 0!==e?"string"==typeof r?i(t).fill(e,r):i(t).fill(e):i(t)}(t,e,r)},s.allocUnsafe=function(t){return a(t)},s.allocUnsafeSlow=function(t){return a(t)},s.isBuffer=function(t){return null!=t&&!0===t._isBuffer&&t!==s.prototype},s.compare=function(t,e){if(H(t,Uint8Array)&&(t=s.from(t,t.offset,t.byteLength)),H(e,Uint8Array)&&(e=s.from(e,e.offset,e.byteLength)),!s.isBuffer(t)||!s.isBuffer(e))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(t===e)return 0;for(var r=t.length,n=e.length,i=0,u=Math.min(r,n);i<u;++i)if(t[i]!==e[i]){r=t[i],n=e[i];break}return r<n?-1:n<r?1:0},s.isEncoding=function(t){switch(String(t).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},s.concat=function(t,e){if(!Array.isArray(t))throw new TypeError('"list" argument must be an Array of Buffers');if(0===t.length)return s.alloc(0);var r;if(void 0===e)for(e=0,r=0;r<t.length;++r)e+=t[r].length;var n=s.allocUnsafe(e),i=0;for(r=0;r<t.length;++r){var u=t[r];if(H(u,Uint8Array))i+u.length>n.length?s.from(u).copy(n,i):Uint8Array.prototype.set.call(n,u,i);else{if(!s.isBuffer(u))throw new TypeError('"list" argument must be an Array of Buffers');u.copy(n,i)}i+=u.length}return n},s.byteLength=p,s.prototype._isBuffer=!0,s.prototype.swap16=function(){var t=this.length;if(t%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var e=0;e<t;e+=2)y(this,e,e+1);return this},s.prototype.swap32=function(){var t=this.length;if(t%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var e=0;e<t;e+=4)y(this,e,e+3),y(this,e+1,e+2);return this},s.prototype.swap64=function(){var t=this.length;if(t%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var e=0;e<t;e+=8)y(this,e,e+7),y(this,e+1,e+6),y(this,e+2,e+5),y(this,e+3,e+4);return this},s.prototype.toString=function(){var t=this.length;return 0===t?"":0===arguments.length?I(this,0,t):l.apply(this,arguments)},s.prototype.toLocaleString=s.prototype.toString,s.prototype.equals=function(t){if(!s.isBuffer(t))throw new TypeError("Argument must be a Buffer");return this===t||0===s.compare(this,t)},s.prototype.inspect=function(){var t="",r=e.INSPECT_MAX_BYTES;return t=this.toString("hex",0,r).replace(/(.{2})/g,"$1 ").trim(),this.length>r&&(t+=" ... "),"<Buffer "+t+">"},r&&(s.prototype[r]=s.prototype.inspect),s.prototype.compare=function(t,e,r,n,i){if(H(t,Uint8Array)&&(t=s.from(t,t.offset,t.byteLength)),!s.isBuffer(t))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof t);if(void 0===e&&(e=0),void 0===r&&(r=t?t.length:0),void 0===n&&(n=0),void 0===i&&(i=this.length),e<0||r>t.length||n<0||i>this.length)throw new RangeError("out of range index");if(n>=i&&e>=r)return 0;if(n>=i)return-1;if(e>=r)return 1;if(this===t)return 0;for(var u=(i>>>=0)-(n>>>=0),o=(r>>>=0)-(e>>>=0),a=Math.min(u,o),f=this.slice(n,i),h=t.slice(e,r),c=0;c<a;++c)if(f[c]!==h[c]){u=f[c],o=h[c];break}return u<o?-1:o<u?1:0},s.prototype.includes=function(t,e,r){return-1!==this.indexOf(t,e,r)},s.prototype.indexOf=function(t,e,r){return g(this,t,e,r,!0)},s.prototype.lastIndexOf=function(t,e,r){return g(this,t,e,r,!1)},s.prototype.write=function(t,e,r,n){if(void 0===e)n="utf8",r=this.length,e=0;else if(void 0===r&&"string"==typeof e)n=e,r=this.length,e=0;else{if(!isFinite(e))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");e>>>=0,isFinite(r)?(r>>>=0,void 0===n&&(n="utf8")):(n=r,r=void 0)}var i=this.length-e;if((void 0===r||r>i)&&(r=i),t.length>0&&(r<0||e<0)||e>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var s=!1;;)switch(n){case"hex":return m(this,t,e,r);case"utf8":case"utf-8":return A(this,t,e,r);case"ascii":case"latin1":case"binary":return E(this,t,e,r);case"base64":return B(this,t,e,r);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return S(this,t,e,r);default:if(s)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),s=!0}},s.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var N=4096;function T(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(127&t[i]);return n}function U(t,e,r){var n="";r=Math.min(t.length,r);for(var i=e;i<r;++i)n+=String.fromCharCode(t[i]);return n}function O(t,e,r){var n=t.length;(!e||e<0)&&(e=0),(!r||r<0||r>n)&&(r=n);for(var i="",s=e;s<r;++s)i+=K[t[s]];return i}function R(t,e,r){for(var n=t.slice(e,r),i="",s=0;s<n.length-1;s+=2)i+=String.fromCharCode(n[s]+256*n[s+1]);return i}function P(t,e,r){if(t%1!=0||t<0)throw new RangeError("offset is not uint");if(t+e>r)throw new RangeError("Trying to access beyond buffer length")}function M(t,e,r,n,i,u){if(!s.isBuffer(t))throw new TypeError('"buffer" argument must be a Buffer instance');if(e>i||e<u)throw new RangeError('"value" argument is out of bounds');if(r+n>t.length)throw new RangeError("Index out of range")}function F(t,e,r,n,i,s){if(r+n>t.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("Index out of range")}function C(t,e,r,n,i){return e=+e,r>>>=0,i||F(t,0,r,4),v(t,e,r,n,23,4),r+4}function L(t,e,r,n,i){return e=+e,r>>>=0,i||F(t,0,r,8),v(t,e,r,n,52,8),r+8}s.prototype.slice=function(t,e){var r=this.length;(t=~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),(e=void 0===e?r:~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),e<t&&(e=t);var n=this.subarray(t,e);return Object.setPrototypeOf(n,s.prototype),n},s.prototype.readUintLE=s.prototype.readUIntLE=function(t,e,r){t>>>=0,e>>>=0,r||P(t,e,this.length);for(var n=this[t],i=1,s=0;++s<e&&(i*=256);)n+=this[t+s]*i;return n},s.prototype.readUintBE=s.prototype.readUIntBE=function(t,e,r){t>>>=0,e>>>=0,r||P(t,e,this.length);for(var n=this[t+--e],i=1;e>0&&(i*=256);)n+=this[t+--e]*i;return n},s.prototype.readUint8=s.prototype.readUInt8=function(t,e){return t>>>=0,e||P(t,1,this.length),this[t]},s.prototype.readUint16LE=s.prototype.readUInt16LE=function(t,e){return t>>>=0,e||P(t,2,this.length),this[t]|this[t+1]<<8},s.prototype.readUint16BE=s.prototype.readUInt16BE=function(t,e){return t>>>=0,e||P(t,2,this.length),this[t]<<8|this[t+1]},s.prototype.readUint32LE=s.prototype.readUInt32LE=function(t,e){return t>>>=0,e||P(t,4,this.length),(this[t]|this[t+1]<<8|this[t+2]<<16)+16777216*this[t+3]},s.prototype.readUint32BE=s.prototype.readUInt32BE=function(t,e){return t>>>=0,e||P(t,4,this.length),16777216*this[t]+(this[t+1]<<16|this[t+2]<<8|this[t+3])},s.prototype.readIntLE=function(t,e,r){t>>>=0,e>>>=0,r||P(t,e,this.length);for(var n=this[t],i=1,s=0;++s<e&&(i*=256);)n+=this[t+s]*i;return n>=(i*=128)&&(n-=Math.pow(2,8*e)),n},s.prototype.readIntBE=function(t,e,r){t>>>=0,e>>>=0,r||P(t,e,this.length);for(var n=e,i=1,s=this[t+--n];n>0&&(i*=256);)s+=this[t+--n]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*e)),s},s.prototype.readInt8=function(t,e){return t>>>=0,e||P(t,1,this.length),128&this[t]?-1*(255-this[t]+1):this[t]},s.prototype.readInt16LE=function(t,e){t>>>=0,e||P(t,2,this.length);var r=this[t]|this[t+1]<<8;return 32768&r?4294901760|r:r},s.prototype.readInt16BE=function(t,e){t>>>=0,e||P(t,2,this.length);var r=this[t+1]|this[t]<<8;return 32768&r?4294901760|r:r},s.prototype.readInt32LE=function(t,e){return t>>>=0,e||P(t,4,this.length),this[t]|this[t+1]<<8|this[t+2]<<16|this[t+3]<<24},s.prototype.readInt32BE=function(t,e){return t>>>=0,e||P(t,4,this.length),this[t]<<24|this[t+1]<<16|this[t+2]<<8|this[t+3]},s.prototype.readFloatLE=function(t,e){return t>>>=0,e||P(t,4,this.length),b(this,t,!0,23,4)},s.prototype.readFloatBE=function(t,e){return t>>>=0,e||P(t,4,this.length),b(this,t,!1,23,4)},s.prototype.readDoubleLE=function(t,e){return t>>>=0,e||P(t,8,this.length),b(this,t,!0,52,8)},s.prototype.readDoubleBE=function(t,e){return t>>>=0,e||P(t,8,this.length),b(this,t,!1,52,8)},s.prototype.writeUintLE=s.prototype.writeUIntLE=function(t,e,r,n){(t=+t,e>>>=0,r>>>=0,n)||M(this,t,e,r,Math.pow(2,8*r)-1,0);var i=1,s=0;for(this[e]=255&t;++s<r&&(i*=256);)this[e+s]=t/i&255;return e+r},s.prototype.writeUintBE=s.prototype.writeUIntBE=function(t,e,r,n){(t=+t,e>>>=0,r>>>=0,n)||M(this,t,e,r,Math.pow(2,8*r)-1,0);var i=r-1,s=1;for(this[e+i]=255&t;--i>=0&&(s*=256);)this[e+i]=t/s&255;return e+r},s.prototype.writeUint8=s.prototype.writeUInt8=function(t,e,r){return t=+t,e>>>=0,r||M(this,t,e,1,255,0),this[e]=255&t,e+1},s.prototype.writeUint16LE=s.prototype.writeUInt16LE=function(t,e,r){return t=+t,e>>>=0,r||M(this,t,e,2,65535,0),this[e]=255&t,this[e+1]=t>>>8,e+2},s.prototype.writeUint16BE=s.prototype.writeUInt16BE=function(t,e,r){return t=+t,e>>>=0,r||M(this,t,e,2,65535,0),this[e]=t>>>8,this[e+1]=255&t,e+2},s.prototype.writeUint32LE=s.prototype.writeUInt32LE=function(t,e,r){return t=+t,e>>>=0,r||M(this,t,e,4,4294967295,0),this[e+3]=t>>>24,this[e+2]=t>>>16,this[e+1]=t>>>8,this[e]=255&t,e+4},s.prototype.writeUint32BE=s.prototype.writeUInt32BE=function(t,e,r){return t=+t,e>>>=0,r||M(this,t,e,4,4294967295,0),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},s.prototype.writeIntLE=function(t,e,r,n){if(t=+t,e>>>=0,!n){var i=Math.pow(2,8*r-1);M(this,t,e,r,i-1,-i)}var s=0,u=1,o=0;for(this[e]=255&t;++s<r&&(u*=256);)t<0&&0===o&&0!==this[e+s-1]&&(o=1),this[e+s]=(t/u>>0)-o&255;return e+r},s.prototype.writeIntBE=function(t,e,r,n){if(t=+t,e>>>=0,!n){var i=Math.pow(2,8*r-1);M(this,t,e,r,i-1,-i)}var s=r-1,u=1,o=0;for(this[e+s]=255&t;--s>=0&&(u*=256);)t<0&&0===o&&0!==this[e+s+1]&&(o=1),this[e+s]=(t/u>>0)-o&255;return e+r},s.prototype.writeInt8=function(t,e,r){return t=+t,e>>>=0,r||M(this,t,e,1,127,-128),t<0&&(t=255+t+1),this[e]=255&t,e+1},s.prototype.writeInt16LE=function(t,e,r){return t=+t,e>>>=0,r||M(this,t,e,2,32767,-32768),this[e]=255&t,this[e+1]=t>>>8,e+2},s.prototype.writeInt16BE=function(t,e,r){return t=+t,e>>>=0,r||M(this,t,e,2,32767,-32768),this[e]=t>>>8,this[e+1]=255&t,e+2},s.prototype.writeInt32LE=function(t,e,r){return t=+t,e>>>=0,r||M(this,t,e,4,2147483647,-2147483648),this[e]=255&t,this[e+1]=t>>>8,this[e+2]=t>>>16,this[e+3]=t>>>24,e+4},s.prototype.writeInt32BE=function(t,e,r){return t=+t,e>>>=0,r||M(this,t,e,4,2147483647,-2147483648),t<0&&(t=4294967295+t+1),this[e]=t>>>24,this[e+1]=t>>>16,this[e+2]=t>>>8,this[e+3]=255&t,e+4},s.prototype.writeFloatLE=function(t,e,r){return C(this,t,e,!0,r)},s.prototype.writeFloatBE=function(t,e,r){return C(this,t,e,!1,r)},s.prototype.writeDoubleLE=function(t,e,r){return L(this,t,e,!0,r)},s.prototype.writeDoubleBE=function(t,e,r){return L(this,t,e,!1,r)},s.prototype.copy=function(t,e,r,n){if(!s.isBuffer(t))throw new TypeError("argument should be a Buffer");if(r||(r=0),n||0===n||(n=this.length),e>=t.length&&(e=t.length),e||(e=0),n>0&&n<r&&(n=r),n===r)return 0;if(0===t.length||0===this.length)return 0;if(e<0)throw new RangeError("targetStart out of bounds");if(r<0||r>=this.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),t.length-e<n-r&&(n=t.length-e+r);var i=n-r;return this===t&&"function"==typeof Uint8Array.prototype.copyWithin?this.copyWithin(e,r,n):Uint8Array.prototype.set.call(t,this.subarray(r,n),e),i},s.prototype.fill=function(t,e,r,n){if("string"==typeof t){if("string"==typeof e?(n=e,e=0,r=this.length):"string"==typeof r&&(n=r,r=this.length),void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!s.isEncoding(n))throw new TypeError("Unknown encoding: "+n);if(1===t.length){var i=t.charCodeAt(0);("utf8"===n&&i<128||"latin1"===n)&&(t=i)}}else"number"==typeof t?t&=255:"boolean"==typeof t&&(t=Number(t));if(e<0||this.length<e||this.length<r)throw new RangeError("Out of range index");if(r<=e)return this;var u;if(e>>>=0,r=void 0===r?this.length:r>>>0,t||(t=0),"number"==typeof t)for(u=e;u<r;++u)this[u]=t;else{var o=s.isBuffer(t)?t:s.from(t,n),a=o.length;if(0===a)throw new TypeError('The value "'+t+'" is invalid for argument "value"');for(u=0;u<r-e;++u)this[u+e]=o[u%a]}return this};var k=/[^+/0-9A-Za-z-_]/g;function x(t,e){var r;e=e||1/0;for(var n=t.length,i=null,s=[],u=0;u<n;++u){if((r=t.charCodeAt(u))>55295&&r<57344){if(!i){if(r>56319){(e-=3)>-1&&s.push(239,191,189);continue}if(u+1===n){(e-=3)>-1&&s.push(239,191,189);continue}i=r;continue}if(r<56320){(e-=3)>-1&&s.push(239,191,189),i=r;continue}r=65536+(i-55296<<10|r-56320)}else i&&(e-=3)>-1&&s.push(239,191,189);if(i=null,r<128){if((e-=1)<0)break;s.push(r)}else if(r<2048){if((e-=2)<0)break;s.push(r>>6|192,63&r|128)}else if(r<65536){if((e-=3)<0)break;s.push(r>>12|224,r>>6&63|128,63&r|128)}else{if(!(r<1114112))throw new Error("Invalid code point");if((e-=4)<0)break;s.push(r>>18|240,r>>12&63|128,r>>6&63|128,63&r|128)}}return s}function D(t){return w.toByteArray(function(t){if((t=(t=t.split("=")[0]).trim().replace(k,"")).length<2)return"";for(;t.length%4!=0;)t+="=";return t}(t))}function j(t,e,r,n){for(var i=0;i<n&&!(i+r>=e.length||i>=t.length);++i)e[i+r]=t[i];return i}function H(t,e){return t instanceof e||null!=t&&null!=t.constructor&&null!=t.constructor.name&&t.constructor.name===e.name}function G(t){return t!=t}var K=function(){for(var t="0123456789abcdef",e=new Array(256),r=0;r<16;++r)for(var n=16*r,i=0;i<16;++i)e[n+i]=t[r]+t[i];return e}()})),E=u((function(t){!function(e){var r,n=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,i=Math.ceil,s=Math.floor,u="[BigNumber Error] ",o=u+"Number primitive has more than 15 significant digits: ",a=1e14,f=14,h=9007199254740991,c=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],p=1e7,l=1e9;function y(t){var e=0|t;return t>0||t===e?e:e-1}function g(t){for(var e,r,n=1,i=t.length,s=t[0]+"";n<i;){for(e=t[n++]+"",r=f-e.length;r--;e="0"+e);s+=e}for(i=s.length;48===s.charCodeAt(--i););return s.slice(0,i+1||1)}function d(t,e){var r,n,i=t.c,s=e.c,u=t.s,o=e.s,a=t.e,f=e.e;if(!u||!o)return null;if(r=i&&!i[0],n=s&&!s[0],r||n)return r?n?0:-o:u;if(u!=o)return u;if(r=u<0,n=a==f,!i||!s)return n?0:!i^r?1:-1;if(!n)return a>f^r?1:-1;for(o=(a=i.length)<(f=s.length)?a:f,u=0;u<o;u++)if(i[u]!=s[u])return i[u]>s[u]^r?1:-1;return a==f?0:a>f^r?1:-1}function m(t,e,r,n){if(t<e||t>r||t!==s(t))throw Error(u+(n||"Argument")+("number"==typeof t?t<e||t>r?" out of range: ":" not an integer: ":" not a primitive number: ")+String(t))}function w(t){var e=t.c.length-1;return y(t.e/f)==e&&t.c[e]%2!=0}function b(t,e){return(t.length>1?t.charAt(0)+"."+t.slice(1):t)+(e<0?"e":"e+")+e}function v(t,e,r){var n,i;if(e<0){for(i=r+".";++e;i+=r);t=i+t}else if(++e>(n=t.length)){for(i=r,e-=n;--e;i+=r);t+=i}else e<n&&(t=t.slice(0,e)+"."+t.slice(e));return t}(r=function t(e){var r,A,E,B,S,_,I,N,T,U,O=K.prototype={constructor:K,toString:null,valueOf:null},R=new K(1),P=20,M=4,F=-7,C=21,L=-1e7,k=1e7,x=!1,D=1,j=0,H={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:" ",suffix:""},G="0123456789abcdefghijklmnopqrstuvwxyz";function K(t,e){var r,i,u,a,c,p,l,y,g=this;if(!(g instanceof K))return new K(t,e);if(null==e){if(t&&!0===t._isBigNumber)return g.s=t.s,void(!t.c||t.e>k?g.c=g.e=null:t.e<L?g.c=[g.e=0]:(g.e=t.e,g.c=t.c.slice()));if((p="number"==typeof t)&&0*t==0){if(g.s=1/t<0?(t=-t,-1):1,t===~~t){for(a=0,c=t;c>=10;c/=10,a++);return void(a>k?g.c=g.e=null:(g.e=a,g.c=[t]))}y=String(t)}else{if(!n.test(y=String(t)))return E(g,y,p);g.s=45==y.charCodeAt(0)?(y=y.slice(1),-1):1}(a=y.indexOf("."))>-1&&(y=y.replace(".","")),(c=y.search(/e/i))>0?(a<0&&(a=c),a+=+y.slice(c+1),y=y.substring(0,c)):a<0&&(a=y.length)}else{if(m(e,2,G.length,"Base"),10==e)return W(g=new K(t),P+g.e+1,M);if(y=String(t),p="number"==typeof t){if(0*t!=0)return E(g,y,p,e);if(g.s=1/t<0?(y=y.slice(1),-1):1,K.DEBUG&&y.replace(/^0\.0*|\./,"").length>15)throw Error(o+t)}else g.s=45===y.charCodeAt(0)?(y=y.slice(1),-1):1;for(r=G.slice(0,e),a=c=0,l=y.length;c<l;c++)if(r.indexOf(i=y.charAt(c))<0){if("."==i){if(c>a){a=l;continue}}else if(!u&&(y==y.toUpperCase()&&(y=y.toLowerCase())||y==y.toLowerCase()&&(y=y.toUpperCase()))){u=!0,c=-1,a=0;continue}return E(g,String(t),p,e)}p=!1,(a=(y=A(y,e,10,g.s)).indexOf("."))>-1?y=y.replace(".",""):a=y.length}for(c=0;48===y.charCodeAt(c);c++);for(l=y.length;48===y.charCodeAt(--l););if(y=y.slice(c,++l)){if(l-=c,p&&K.DEBUG&&l>15&&(t>h||t!==s(t)))throw Error(o+g.s*t);if((a=a-c-1)>k)g.c=g.e=null;else if(a<L)g.c=[g.e=0];else{if(g.e=a,g.c=[],c=(a+1)%f,a<0&&(c+=f),c<l){for(c&&g.c.push(+y.slice(0,c)),l-=f;c<l;)g.c.push(+y.slice(c,c+=f));c=f-(y=y.slice(c)).length}else c-=l;for(;c--;y+="0");g.c.push(+y)}}else g.c=[g.e=0]}function $(t,e,r,n){var i,s,u,o,a;if(null==r?r=M:m(r,0,8),!t.c)return t.toString();if(i=t.c[0],u=t.e,null==e)a=g(t.c),a=1==n||2==n&&(u<=F||u>=C)?b(a,u):v(a,u,"0");else if(s=(t=W(new K(t),e,r)).e,o=(a=g(t.c)).length,1==n||2==n&&(e<=s||s<=F)){for(;o<e;a+="0",o++);a=b(a,s)}else if(e-=u,a=v(a,s,"0"),s+1>o){if(--e>0)for(a+=".";e--;a+="0");}else if((e+=s-o)>0)for(s+1==o&&(a+=".");e--;a+="0");return t.s<0&&i?"-"+a:a}function z(t,e){for(var r,n=1,i=new K(t[0]);n<t.length;n++){if(!(r=new K(t[n])).s){i=r;break}e.call(i,r)&&(i=r)}return i}function Y(t,e,r){for(var n=1,i=e.length;!e[--i];e.pop());for(i=e[0];i>=10;i/=10,n++);return(r=n+r*f-1)>k?t.c=t.e=null:r<L?t.c=[t.e=0]:(t.e=r,t.c=e),t}function W(t,e,r,n){var u,o,h,p,l,y,g,d=t.c,m=c;if(d){t:{for(u=1,p=d[0];p>=10;p/=10,u++);if((o=e-u)<0)o+=f,h=e,g=(l=d[y=0])/m[u-h-1]%10|0;else if((y=i((o+1)/f))>=d.length){if(!n)break t;for(;d.length<=y;d.push(0));l=g=0,u=1,h=(o%=f)-f+1}else{for(l=p=d[y],u=1;p>=10;p/=10,u++);g=(h=(o%=f)-f+u)<0?0:l/m[u-h-1]%10|0}if(n=n||e<0||null!=d[y+1]||(h<0?l:l%m[u-h-1]),n=r<4?(g||n)&&(0==r||r==(t.s<0?3:2)):g>5||5==g&&(4==r||n||6==r&&(o>0?h>0?l/m[u-h]:0:d[y-1])%10&1||r==(t.s<0?8:7)),e<1||!d[0])return d.length=0,n?(e-=t.e+1,d[0]=m[(f-e%f)%f],t.e=-e||0):d[0]=t.e=0,t;if(0==o?(d.length=y,p=1,y--):(d.length=y+1,p=m[f-o],d[y]=h>0?s(l/m[u-h]%m[h])*p:0),n)for(;;){if(0==y){for(o=1,h=d[0];h>=10;h/=10,o++);for(h=d[0]+=p,p=1;h>=10;h/=10,p++);o!=p&&(t.e++,d[0]==a&&(d[0]=1));break}if(d[y]+=p,d[y]!=a)break;d[y--]=0,p=1}for(o=d.length;0===d[--o];d.pop());}t.e>k?t.c=t.e=null:t.e<L&&(t.c=[t.e=0])}return t}function q(t){var e,r=t.e;return null===r?t.toString():(e=g(t.c),e=r<=F||r>=C?b(e,r):v(e,r,"0"),t.s<0?"-"+e:e)}return K.clone=t,K.ROUND_UP=0,K.ROUND_DOWN=1,K.ROUND_CEIL=2,K.ROUND_FLOOR=3,K.ROUND_HALF_UP=4,K.ROUND_HALF_DOWN=5,K.ROUND_HALF_EVEN=6,K.ROUND_HALF_CEIL=7,K.ROUND_HALF_FLOOR=8,K.EUCLID=9,K.config=K.set=function(t){var e,r;if(null!=t){if("object"!=typeof t)throw Error(u+"Object expected: "+t);if(t.hasOwnProperty(e="DECIMAL_PLACES")&&(m(r=t[e],0,l,e),P=r),t.hasOwnProperty(e="ROUNDING_MODE")&&(m(r=t[e],0,8,e),M=r),t.hasOwnProperty(e="EXPONENTIAL_AT")&&((r=t[e])&&r.pop?(m(r[0],-l,0,e),m(r[1],0,l,e),F=r[0],C=r[1]):(m(r,-l,l,e),F=-(C=r<0?-r:r))),t.hasOwnProperty(e="RANGE"))if((r=t[e])&&r.pop)m(r[0],-l,-1,e),m(r[1],1,l,e),L=r[0],k=r[1];else{if(m(r,-l,l,e),!r)throw Error(u+e+" cannot be zero: "+r);L=-(k=r<0?-r:r)}if(t.hasOwnProperty(e="CRYPTO")){if((r=t[e])!==!!r)throw Error(u+e+" not true or false: "+r);if(r){if("undefined"==typeof crypto||!crypto||!crypto.getRandomValues&&!crypto.randomBytes)throw x=!r,Error(u+"crypto unavailable");x=r}else x=r}if(t.hasOwnProperty(e="MODULO_MODE")&&(m(r=t[e],0,9,e),D=r),t.hasOwnProperty(e="POW_PRECISION")&&(m(r=t[e],0,l,e),j=r),t.hasOwnProperty(e="FORMAT")){if("object"!=typeof(r=t[e]))throw Error(u+e+" not an object: "+r);H=r}if(t.hasOwnProperty(e="ALPHABET")){if("string"!=typeof(r=t[e])||/^.?$|[+\-.\s]|(.).*\1/.test(r))throw Error(u+e+" invalid: "+r);G=r}}return{DECIMAL_PLACES:P,ROUNDING_MODE:M,EXPONENTIAL_AT:[F,C],RANGE:[L,k],CRYPTO:x,MODULO_MODE:D,POW_PRECISION:j,FORMAT:H,ALPHABET:G}},K.isBigNumber=function(t){if(!t||!0!==t._isBigNumber)return!1;if(!K.DEBUG)return!0;var e,r,n=t.c,i=t.e,o=t.s;t:if("[object Array]"=={}.toString.call(n)){if((1===o||-1===o)&&i>=-l&&i<=l&&i===s(i)){if(0===n[0]){if(0===i&&1===n.length)return!0;break t}if((e=(i+1)%f)<1&&(e+=f),String(n[0]).length==e){for(e=0;e<n.length;e++)if((r=n[e])<0||r>=a||r!==s(r))break t;if(0!==r)return!0}}}else if(null===n&&null===i&&(null===o||1===o||-1===o))return!0;throw Error(u+"Invalid BigNumber: "+t)},K.maximum=K.max=function(){return z(arguments,O.lt)},K.minimum=K.min=function(){return z(arguments,O.gt)},K.random=(B=9007199254740992,S=Math.random()*B&2097151?function(){return s(Math.random()*B)}:function(){return 8388608*(1073741824*Math.random()|0)+(8388608*Math.random()|0)},function(t){var e,r,n,o,a,h=0,p=[],y=new K(R);if(null==t?t=P:m(t,0,l),o=i(t/f),x)if(crypto.getRandomValues){for(e=crypto.getRandomValues(new Uint32Array(o*=2));h<o;)(a=131072*e[h]+(e[h+1]>>>11))>=9e15?(r=crypto.getRandomValues(new Uint32Array(2)),e[h]=r[0],e[h+1]=r[1]):(p.push(a%1e14),h+=2);h=o/2}else{if(!crypto.randomBytes)throw x=!1,Error(u+"crypto unavailable");for(e=crypto.randomBytes(o*=7);h<o;)(a=281474976710656*(31&e[h])+1099511627776*e[h+1]+4294967296*e[h+2]+16777216*e[h+3]+(e[h+4]<<16)+(e[h+5]<<8)+e[h+6])>=9e15?crypto.randomBytes(7).copy(e,h):(p.push(a%1e14),h+=7);h=o/7}if(!x)for(;h<o;)(a=S())<9e15&&(p[h++]=a%1e14);for(o=p[--h],t%=f,o&&t&&(a=c[f-t],p[h]=s(o/a)*a);0===p[h];p.pop(),h--);if(h<0)p=[n=0];else{for(n=-1;0===p[0];p.splice(0,1),n-=f);for(h=1,a=p[0];a>=10;a/=10,h++);h<f&&(n-=f-h)}return y.e=n,y.c=p,y}),K.sum=function(){for(var t=1,e=arguments,r=new K(e[0]);t<e.length;)r=r.plus(e[t++]);return r},A=function(){var t="0123456789";function e(t,e,r,n){for(var i,s,u=[0],o=0,a=t.length;o<a;){for(s=u.length;s--;u[s]*=e);for(u[0]+=n.indexOf(t.charAt(o++)),i=0;i<u.length;i++)u[i]>r-1&&(null==u[i+1]&&(u[i+1]=0),u[i+1]+=u[i]/r|0,u[i]%=r)}return u.reverse()}return function(n,i,s,u,o){var a,f,h,c,p,l,y,d,m=n.indexOf("."),w=P,b=M;for(m>=0&&(c=j,j=0,n=n.replace(".",""),l=(d=new K(i)).pow(n.length-m),j=c,d.c=e(v(g(l.c),l.e,"0"),10,s,t),d.e=d.c.length),h=c=(y=e(n,i,s,o?(a=G,t):(a=t,G))).length;0==y[--c];y.pop());if(!y[0])return a.charAt(0);if(m<0?--h:(l.c=y,l.e=h,l.s=u,y=(l=r(l,d,w,b,s)).c,p=l.r,h=l.e),m=y[f=h+w+1],c=s/2,p=p||f<0||null!=y[f+1],p=b<4?(null!=m||p)&&(0==b||b==(l.s<0?3:2)):m>c||m==c&&(4==b||p||6==b&&1&y[f-1]||b==(l.s<0?8:7)),f<1||!y[0])n=p?v(a.charAt(1),-w,a.charAt(0)):a.charAt(0);else{if(y.length=f,p)for(--s;++y[--f]>s;)y[f]=0,f||(++h,y=[1].concat(y));for(c=y.length;!y[--c];);for(m=0,n="";m<=c;n+=a.charAt(y[m++]));n=v(n,h,a.charAt(0))}return n}}(),r=function(){function t(t,e,r){var n,i,s,u,o=0,a=t.length,f=e%p,h=e/p|0;for(t=t.slice();a--;)o=((i=f*(s=t[a]%p)+(n=h*s+(u=t[a]/p|0)*f)%p*p+o)/r|0)+(n/p|0)+h*u,t[a]=i%r;return o&&(t=[o].concat(t)),t}function e(t,e,r,n){var i,s;if(r!=n)s=r>n?1:-1;else for(i=s=0;i<r;i++)if(t[i]!=e[i]){s=t[i]>e[i]?1:-1;break}return s}function r(t,e,r,n){for(var i=0;r--;)t[r]-=i,i=t[r]<e[r]?1:0,t[r]=i*n+t[r]-e[r];for(;!t[0]&&t.length>1;t.splice(0,1));}return function(n,i,u,o,h){var c,p,l,g,d,m,w,b,v,A,E,B,S,_,I,N,T,U=n.s==i.s?1:-1,O=n.c,R=i.c;if(!(O&&O[0]&&R&&R[0]))return new K(n.s&&i.s&&(O?!R||O[0]!=R[0]:R)?O&&0==O[0]||!R?0*U:U/0:NaN);for(v=(b=new K(U)).c=[],U=u+(p=n.e-i.e)+1,h||(h=a,p=y(n.e/f)-y(i.e/f),U=U/f|0),l=0;R[l]==(O[l]||0);l++);if(R[l]>(O[l]||0)&&p--,U<0)v.push(1),g=!0;else{for(_=O.length,N=R.length,l=0,U+=2,(d=s(h/(R[0]+1)))>1&&(R=t(R,d,h),O=t(O,d,h),N=R.length,_=O.length),S=N,E=(A=O.slice(0,N)).length;E<N;A[E++]=0);T=R.slice(),T=[0].concat(T),I=R[0],R[1]>=h/2&&I++;do{if(d=0,(c=e(R,A,N,E))<0){if(B=A[0],N!=E&&(B=B*h+(A[1]||0)),(d=s(B/I))>1)for(d>=h&&(d=h-1),w=(m=t(R,d,h)).length,E=A.length;1==e(m,A,w,E);)d--,r(m,N<w?T:R,w,h),w=m.length,c=1;else 0==d&&(c=d=1),w=(m=R.slice()).length;if(w<E&&(m=[0].concat(m)),r(A,m,E,h),E=A.length,-1==c)for(;e(R,A,N,E)<1;)d++,r(A,N<E?T:R,E,h),E=A.length}else 0===c&&(d++,A=[0]);v[l++]=d,A[0]?A[E++]=O[S]||0:(A=[O[S]],E=1)}while((S++<_||null!=A[0])&&U--);g=null!=A[0],v[0]||v.splice(0,1)}if(h==a){for(l=1,U=v[0];U>=10;U/=10,l++);W(b,u+(b.e=l+p*f-1)+1,o,g)}else b.e=p,b.r=+g;return b}}(),_=/^(-?)0([xbo])(?=\w[\w.]*$)/i,I=/^([^.]+)\.$/,N=/^\.([^.]+)$/,T=/^-?(Infinity|NaN)$/,U=/^\s*\+(?=[\w.])|^\s+|\s+$/g,E=function(t,e,r,n){var i,s=r?e:e.replace(U,"");if(T.test(s))t.s=isNaN(s)?null:s<0?-1:1;else{if(!r&&(s=s.replace(_,(function(t,e,r){return i="x"==(r=r.toLowerCase())?16:"b"==r?2:8,n&&n!=i?t:e})),n&&(i=n,s=s.replace(I,"$1").replace(N,"0.$1")),e!=s))return new K(s,i);if(K.DEBUG)throw Error(u+"Not a"+(n?" base "+n:"")+" number: "+e);t.s=null}t.c=t.e=null},O.absoluteValue=O.abs=function(){var t=new K(this);return t.s<0&&(t.s=1),t},O.comparedTo=function(t,e){return d(this,new K(t,e))},O.decimalPlaces=O.dp=function(t,e){var r,n,i,s=this;if(null!=t)return m(t,0,l),null==e?e=M:m(e,0,8),W(new K(s),t+s.e+1,e);if(!(r=s.c))return null;if(n=((i=r.length-1)-y(this.e/f))*f,i=r[i])for(;i%10==0;i/=10,n--);return n<0&&(n=0),n},O.dividedBy=O.div=function(t,e){return r(this,new K(t,e),P,M)},O.dividedToIntegerBy=O.idiv=function(t,e){return r(this,new K(t,e),0,1)},O.exponentiatedBy=O.pow=function(t,e){var r,n,o,a,h,c,p,l,y=this;if((t=new K(t)).c&&!t.isInteger())throw Error(u+"Exponent not an integer: "+q(t));if(null!=e&&(e=new K(e)),h=t.e>14,!y.c||!y.c[0]||1==y.c[0]&&!y.e&&1==y.c.length||!t.c||!t.c[0])return l=new K(Math.pow(+q(y),h?2-w(t):+q(t))),e?l.mod(e):l;if(c=t.s<0,e){if(e.c?!e.c[0]:!e.s)return new K(NaN);(n=!c&&y.isInteger()&&e.isInteger())&&(y=y.mod(e))}else{if(t.e>9&&(y.e>0||y.e<-1||(0==y.e?y.c[0]>1||h&&y.c[1]>=24e7:y.c[0]<8e13||h&&y.c[0]<=9999975e7)))return a=y.s<0&&w(t)?-0:0,y.e>-1&&(a=1/a),new K(c?1/a:a);j&&(a=i(j/f+2))}for(h?(r=new K(.5),c&&(t.s=1),p=w(t)):p=(o=Math.abs(+q(t)))%2,l=new K(R);;){if(p){if(!(l=l.times(y)).c)break;a?l.c.length>a&&(l.c.length=a):n&&(l=l.mod(e))}if(o){if(0===(o=s(o/2)))break;p=o%2}else if(W(t=t.times(r),t.e+1,1),t.e>14)p=w(t);else{if(0===(o=+q(t)))break;p=o%2}y=y.times(y),a?y.c&&y.c.length>a&&(y.c.length=a):n&&(y=y.mod(e))}return n?l:(c&&(l=R.div(l)),e?l.mod(e):a?W(l,j,M,undefined):l)},O.integerValue=function(t){var e=new K(this);return null==t?t=M:m(t,0,8),W(e,e.e+1,t)},O.isEqualTo=O.eq=function(t,e){return 0===d(this,new K(t,e))},O.isFinite=function(){return!!this.c},O.isGreaterThan=O.gt=function(t,e){return d(this,new K(t,e))>0},O.isGreaterThanOrEqualTo=O.gte=function(t,e){return 1===(e=d(this,new K(t,e)))||0===e},O.isInteger=function(){return!!this.c&&y(this.e/f)>this.c.length-2},O.isLessThan=O.lt=function(t,e){return d(this,new K(t,e))<0},O.isLessThanOrEqualTo=O.lte=function(t,e){return-1===(e=d(this,new K(t,e)))||0===e},O.isNaN=function(){return!this.s},O.isNegative=function(){return this.s<0},O.isPositive=function(){return this.s>0},O.isZero=function(){return!!this.c&&0==this.c[0]},O.minus=function(t,e){var r,n,i,s,u=this,o=u.s;if(e=(t=new K(t,e)).s,!o||!e)return new K(NaN);if(o!=e)return t.s=-e,u.plus(t);var h=u.e/f,c=t.e/f,p=u.c,l=t.c;if(!h||!c){if(!p||!l)return p?(t.s=-e,t):new K(l?u:NaN);if(!p[0]||!l[0])return l[0]?(t.s=-e,t):new K(p[0]?u:3==M?-0:0)}if(h=y(h),c=y(c),p=p.slice(),o=h-c){for((s=o<0)?(o=-o,i=p):(c=h,i=l),i.reverse(),e=o;e--;i.push(0));i.reverse()}else for(n=(s=(o=p.length)<(e=l.length))?o:e,o=e=0;e<n;e++)if(p[e]!=l[e]){s=p[e]<l[e];break}if(s&&(i=p,p=l,l=i,t.s=-t.s),(e=(n=l.length)-(r=p.length))>0)for(;e--;p[r++]=0);for(e=a-1;n>o;){if(p[--n]<l[n]){for(r=n;r&&!p[--r];p[r]=e);--p[r],p[n]+=a}p[n]-=l[n]}for(;0==p[0];p.splice(0,1),--c);return p[0]?Y(t,p,c):(t.s=3==M?-1:1,t.c=[t.e=0],t)},O.modulo=O.mod=function(t,e){var n,i,s=this;return t=new K(t,e),!s.c||!t.s||t.c&&!t.c[0]?new K(NaN):!t.c||s.c&&!s.c[0]?new K(s):(9==D?(i=t.s,t.s=1,n=r(s,t,0,3),t.s=i,n.s*=i):n=r(s,t,0,D),(t=s.minus(n.times(t))).c[0]||1!=D||(t.s=s.s),t)},O.multipliedBy=O.times=function(t,e){var r,n,i,s,u,o,h,c,l,g,d,m,w,b,v,A=this,E=A.c,B=(t=new K(t,e)).c;if(!(E&&B&&E[0]&&B[0]))return!A.s||!t.s||E&&!E[0]&&!B||B&&!B[0]&&!E?t.c=t.e=t.s=null:(t.s*=A.s,E&&B?(t.c=[0],t.e=0):t.c=t.e=null),t;for(n=y(A.e/f)+y(t.e/f),t.s*=A.s,(h=E.length)<(g=B.length)&&(w=E,E=B,B=w,i=h,h=g,g=i),i=h+g,w=[];i--;w.push(0));for(b=a,v=p,i=g;--i>=0;){for(r=0,d=B[i]%v,m=B[i]/v|0,s=i+(u=h);s>i;)r=((c=d*(c=E[--u]%v)+(o=m*c+(l=E[u]/v|0)*d)%v*v+w[s]+r)/b|0)+(o/v|0)+m*l,w[s--]=c%b;w[s]=r}return r?++n:w.splice(0,1),Y(t,w,n)},O.negated=function(){var t=new K(this);return t.s=-t.s||null,t},O.plus=function(t,e){var r,n=this,i=n.s;if(e=(t=new K(t,e)).s,!i||!e)return new K(NaN);if(i!=e)return t.s=-e,n.minus(t);var s=n.e/f,u=t.e/f,o=n.c,h=t.c;if(!s||!u){if(!o||!h)return new K(i/0);if(!o[0]||!h[0])return h[0]?t:new K(o[0]?n:0*i)}if(s=y(s),u=y(u),o=o.slice(),i=s-u){for(i>0?(u=s,r=h):(i=-i,r=o),r.reverse();i--;r.push(0));r.reverse()}for((i=o.length)-(e=h.length)<0&&(r=h,h=o,o=r,e=i),i=0;e;)i=(o[--e]=o[e]+h[e]+i)/a|0,o[e]=a===o[e]?0:o[e]%a;return i&&(o=[i].concat(o),++u),Y(t,o,u)},O.precision=O.sd=function(t,e){var r,n,i,s=this;if(null!=t&&t!==!!t)return m(t,1,l),null==e?e=M:m(e,0,8),W(new K(s),t,e);if(!(r=s.c))return null;if(n=(i=r.length-1)*f+1,i=r[i]){for(;i%10==0;i/=10,n--);for(i=r[0];i>=10;i/=10,n++);}return t&&s.e+1>n&&(n=s.e+1),n},O.shiftedBy=function(t){return m(t,-9007199254740991,h),this.times("1e"+t)},O.squareRoot=O.sqrt=function(){var t,e,n,i,s,u=this,o=u.c,a=u.s,f=u.e,h=P+4,c=new K("0.5");if(1!==a||!o||!o[0])return new K(!a||a<0&&(!o||o[0])?NaN:o?u:1/0);if(0==(a=Math.sqrt(+q(u)))||a==1/0?(((e=g(o)).length+f)%2==0&&(e+="0"),a=Math.sqrt(+e),f=y((f+1)/2)-(f<0||f%2),n=new K(e=a==1/0?"5e"+f:(e=a.toExponential()).slice(0,e.indexOf("e")+1)+f)):n=new K(a+""),n.c[0])for((a=(f=n.e)+h)<3&&(a=0);;)if(s=n,n=c.times(s.plus(r(u,s,h,1))),g(s.c).slice(0,a)===(e=g(n.c)).slice(0,a)){if(n.e<f&&--a,"9999"!=(e=e.slice(a-3,a+1))&&(i||"4999"!=e)){+e&&(+e.slice(1)||"5"!=e.charAt(0))||(W(n,n.e+P+2,1),t=!n.times(n).eq(u));break}if(!i&&(W(s,s.e+P+2,0),s.times(s).eq(u))){n=s;break}h+=4,a+=4,i=1}return W(n,n.e+P+1,M,t)},O.toExponential=function(t,e){return null!=t&&(m(t,0,l),t++),$(this,t,e,1)},O.toFixed=function(t,e){return null!=t&&(m(t,0,l),t=t+this.e+1),$(this,t,e)},O.toFormat=function(t,e,r){var n,i=this;if(null==r)null!=t&&e&&"object"==typeof e?(r=e,e=null):t&&"object"==typeof t?(r=t,t=e=null):r=H;else if("object"!=typeof r)throw Error(u+"Argument not an object: "+r);if(n=i.toFixed(t,e),i.c){var s,o=n.split("."),a=+r.groupSize,f=+r.secondaryGroupSize,h=r.groupSeparator||"",c=o[0],p=o[1],l=i.s<0,y=l?c.slice(1):c,g=y.length;if(f&&(s=a,a=f,f=s,g-=s),a>0&&g>0){for(s=g%a||a,c=y.substr(0,s);s<g;s+=a)c+=h+y.substr(s,a);f>0&&(c+=h+y.slice(s)),l&&(c="-"+c)}n=p?c+(r.decimalSeparator||"")+((f=+r.fractionGroupSize)?p.replace(new RegExp("\\d{"+f+"}\\B","g"),"$&"+(r.fractionGroupSeparator||"")):p):c}return(r.prefix||"")+n+(r.suffix||"")},O.toFraction=function(t){var e,n,i,s,o,a,h,p,l,y,d,m,w=this,b=w.c;if(null!=t&&(!(h=new K(t)).isInteger()&&(h.c||1!==h.s)||h.lt(R)))throw Error(u+"Argument "+(h.isInteger()?"out of range: ":"not an integer: ")+q(h));if(!b)return new K(w);for(e=new K(R),l=n=new K(R),i=p=new K(R),m=g(b),o=e.e=m.length-w.e-1,e.c[0]=c[(a=o%f)<0?f+a:a],t=!t||h.comparedTo(e)>0?o>0?e:l:h,a=k,k=1/0,h=new K(m),p.c[0]=0;y=r(h,e,0,1),1!=(s=n.plus(y.times(i))).comparedTo(t);)n=i,i=s,l=p.plus(y.times(s=l)),p=s,e=h.minus(y.times(s=e)),h=s;return s=r(t.minus(n),i,0,1),p=p.plus(s.times(l)),n=n.plus(s.times(i)),p.s=l.s=w.s,d=r(l,i,o*=2,M).minus(w).abs().comparedTo(r(p,n,o,M).minus(w).abs())<1?[l,i]:[p,n],k=a,d},O.toNumber=function(){return+q(this)},O.toPrecision=function(t,e){return null!=t&&m(t,1,l),$(this,t,e,2)},O.toString=function(t){var e,r=this,n=r.s,i=r.e;return null===i?n?(e="Infinity",n<0&&(e="-"+e)):e="NaN":(null==t?e=i<=F||i>=C?b(g(r.c),i):v(g(r.c),i,"0"):10===t?e=v(g((r=W(new K(r),P+i+1,M)).c),r.e,"0"):(m(t,2,G.length,"Base"),e=A(v(g(r.c),i,"0"),10,t,n,!0)),n<0&&r.c[0]&&(e="-"+e)),e},O.valueOf=O.toJSON=function(){return q(this)},O._isBigNumber=!0,null!=e&&K.set(e),K}()).default=r.BigNumber=r,t.exports?t.exports=r:(e||(e="undefined"!=typeof self&&self?self:window),e.BigNumber=r)}(s)}));
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */const B=E.BigNumber;var S={MT:{POS_INT:0,NEG_INT:1,BYTE_STRING:2,UTF8_STRING:3,ARRAY:4,MAP:5,TAG:6,SIMPLE_FLOAT:7},TAG:{DATE_STRING:0,DATE_EPOCH:1,POS_BIGINT:2,NEG_BIGINT:3,DECIMAL_FRAC:4,BIGFLOAT:5,BASE64URL_EXPECTED:21,BASE64_EXPECTED:22,BASE16_EXPECTED:23,CBOR:24,URI:32,BASE64URL:33,BASE64:34,REGEXP:35,MIME:36},NUMBYTES:{ZERO:0,ONE:24,TWO:25,FOUR:26,EIGHT:27,INDEFINITE:31},SIMPLE:{FALSE:20,TRUE:21,NULL:22,UNDEFINED:23},SYMS:{NULL:Symbol("null"),UNDEFINED:Symbol("undef"),PARENT:Symbol("parent"),BREAK:Symbol("break"),STREAM:Symbol("stream")},SHIFT32:Math.pow(2,32),SHIFT16:Math.pow(2,16),MAX_SAFE_HIGH:2097151,NEG_ONE:new B(-1),TEN:new B(10),TWO:new B(2),PARENT:{ARRAY:0,OBJECT:1,MAP:2,TAG:3,BYTE_STRING:4,UTF8_STRING:5}},_=u((function(t,e){const{Buffer:r}=A,n=E.BigNumber,i=S.SHIFT32,s=S.SHIFT16;e.parseHalf=function(t){var e,r,n;return n=128&t[0]?-1:1,e=(124&t[0])>>2,r=(3&t[0])<<8|t[1],e?31===e?n*(r?NaN:Infinity):n*Math.pow(2,e-25)*(1024+r):5.960464477539063e-8*n*r},e.arrayBufferToBignumber=function(t){const e=t.byteLength;let r="";for(let n=0;n<e;n++)r+=(i=t[n])<16?"0"+i.toString(16):i.toString(16);var i;return new n(r,16)},e.buildMap=t=>{const e=new Map,r=Object.keys(t),n=r.length;for(let i=0;i<n;i++)e.set(r[i],t[r[i]]);return e},e.buildInt32=(t,e)=>t*s+e,e.buildInt64=(t,r,s,u)=>{const o=e.buildInt32(t,r),a=e.buildInt32(s,u);return o>2097151?new n(o).times(i).plus(a):o*i+a},e.writeHalf=function(t,e){const n=r.allocUnsafe(4);n.writeFloatBE(e,0);const i=n.readUInt32BE(0);if(0!=(8191&i))return!1;var s=i>>16&32768;const u=i>>23&255,o=8388607&i;if(u>=113&&u<=142)s+=(u-112<<10)+(o>>13);else{if(!(u>=103&&u<113))return!1;if(o&(1<<126-u)-1)return!1;s+=o+8388608>>126-u}return t.writeUInt16BE(s,0),!0},e.keySorter=function(t,e){var r=t[0].byteLength,n=e[0].byteLength;return r>n?1:n>r?-1:t[0].compare(e[0])},e.isNegativeZero=t=>0===t&&1/t<0,e.nextPowerOf2=t=>{let e=0;if(t&&!(t&t-1))return t;for(;0!==t;)t>>=1,e+=1;return 1<<e}}));const I=S.MT,N=S.SIMPLE,T=S.SYMS;class Simple{constructor(t){if("number"!=typeof t)throw new Error("Invalid Simple type: "+typeof t);if(t<0||t>255||(0|t)!==t)throw new Error("value must be a small positive integer: "+t);this.value=t}toString(){return"simple("+this.value+")"}inspect(){return"simple("+this.value+")"}encodeCBOR(t){return t._pushInt(this.value,I.SIMPLE_FLOAT)}static isSimple(t){return t instanceof Simple}static decode(t,e){switch(null==e&&(e=!0),t){case N.FALSE:return!1;case N.TRUE:return!0;case N.NULL:return e?null:T.NULL;case N.UNDEFINED:return e?void 0:T.UNDEFINED;case-1:if(!e)throw new Error("Invalid BREAK");return T.BREAK;default:return new Simple(t)}}}var U=Simple;class Tagged{constructor(t,e,r){if(this.tag=t,this.value=e,this.err=r,"number"!=typeof this.tag)throw new Error("Invalid tag type ("+typeof this.tag+")");if(this.tag<0||(0|this.tag)!==this.tag)throw new Error("Tag must be a positive integer: "+this.tag)}toString(){return`${this.tag}(${JSON.stringify(this.value)})`}encodeCBOR(t){return t._pushTag(this.tag),t.pushAny(this.value)}convert(t){var e,r;if("function"!=typeof(r=null!=t?t[this.tag]:void 0)&&"function"!=typeof(r=Tagged["_tag"+this.tag]))return this;try{return r.call(Tagged,this.value)}catch(t){return e=t,this.err=e,this}}}var O=Tagged;const R=self.location?self.location.protocol+"//"+self.location.host:"",P=self.URL;var M={URLWithLegacySupport:class URLWithLegacySupport$2{constructor(t="",e=R){this.super=new P(t,e),this.path=this.pathname+this.search,this.auth=this.username&&this.password?this.username+":"+this.password:null,this.query=this.search&&this.search.startsWith("?")?this.search.slice(1):null}get hash(){return this.super.hash}get host(){return this.super.host}get hostname(){return this.super.hostname}get href(){return this.super.href}get origin(){return this.super.origin}get password(){return this.super.password}get pathname(){return this.super.pathname}get port(){return this.super.port}get protocol(){return this.super.protocol}get search(){return this.super.search}get searchParams(){return this.super.searchParams}get username(){return this.super.username}set hash(t){this.super.hash=t}set host(t){this.super.host=t}set hostname(t){this.super.hostname=t}set href(t){this.super.href=t}set origin(t){this.super.origin=t}set password(t){this.super.password=t}set pathname(t){this.super.pathname=t}set port(t){this.super.port=t}set protocol(t){this.super.protocol=t}set search(t){this.super.search=t}set searchParams(t){this.super.searchParams=t}set username(t){this.super.username=t}createObjectURL(t){return this.super.createObjectURL(t)}revokeObjectURL(t){this.super.revokeObjectURL(t)}toJSON(){return this.super.toJSON()}toString(){return this.super.toString()}format(){return this.toString()}},URLSearchParams:self.URLSearchParams,defaultBase:R,format:function(t){if("string"==typeof t){return new P(t).toString()}if(!(t instanceof P)){const e=t.username&&t.password?`${t.username}:${t.password}@`:"",r=t.auth?t.auth+"@":"",n=t.port?":"+t.port:"",i=t.protocol?t.protocol+"//":"",s=t.host||"",u=t.hostname||"",o=t.search||(t.query?"?"+t.query:""),a=t.hash||"",f=t.pathname||"";return`${i}${e||r}${s||u+n}${t.path||f+o}${a}`}}};const{URLWithLegacySupport:F,format:C}=M;const{URLWithLegacySupport:L,format:k,URLSearchParams:x,defaultBase:D}=M;var j={URL:L,URLSearchParams:x,format:k,relative:(t,e={},r={},n)=>{let i,s=e.protocol?e.protocol.replace(":",""):"http";s=(r[s]||n||s)+":";try{i=new F(t)}catch(t){i={}}const u=Object.assign({},e,{protocol:s||i.protocol,host:e.host||i.host});return new F(t,C(u)).toString()},defaultBase:D};const{Buffer:H}=A,G=E.BigNumber,{URL:K}=j;class Decoder{constructor(t){!(t=t||{}).size||t.size<65536?t.size=65536:t.size=_.nextPowerOf2(t.size),this._heap=new ArrayBuffer(t.size),this._heap8=new Uint8Array(this._heap),this._buffer=H.from(this._heap),this._reset(),this._knownTags=Object.assign({0:t=>new Date(t),1:t=>new Date(1e3*t),2:t=>_.arrayBufferToBignumber(t),3:t=>S.NEG_ONE.minus(_.arrayBufferToBignumber(t)),4:t=>S.TEN.pow(t[0]).times(t[1]),5:t=>S.TWO.pow(t[0]).times(t[1]),32:t=>new K(t),35:t=>new RegExp(t)},t.tags),this.parser=function(t,e,r){"use asm";var n=new t.Uint8Array(r),i=e.pushInt,s=e.pushInt32,u=e.pushInt32Neg,o=e.pushInt64,a=e.pushInt64Neg,f=e.pushFloat,h=e.pushFloatSingle,c=e.pushFloatDouble,p=e.pushTrue,l=e.pushFalse,y=e.pushUndefined,g=e.pushNull,d=e.pushInfinity,m=e.pushInfinityNeg,w=e.pushNaN,b=e.pushNaNNeg,v=e.pushArrayStart,A=e.pushArrayStartFixed,E=e.pushArrayStartFixed32,B=e.pushArrayStartFixed64,S=e.pushObjectStart,_=e.pushObjectStartFixed,I=e.pushObjectStartFixed32,N=e.pushObjectStartFixed64,T=e.pushByteString,U=e.pushByteStringStart,O=e.pushUtf8String,R=e.pushUtf8StringStart,P=e.pushSimpleUnassigned,M=e.pushTagStart,F=e.pushTagStart4,C=e.pushTagStart8,L=e.pushTagUnassigned,k=e.pushBreak,x=t.Math.pow,D=0,j=0,H=0;function G(t){t=t|0;D=0;j=t;while((D|0)<(j|0)){H=Xt[n[D]&255](n[D]|0)|0;if((H|0)>0){break}}return H|0}function K(t){t=t|0;if(((D|0)+(t|0)|0)<(j|0)){return 0}return 1}function $(t){t=t|0;return n[t|0]<<8|n[t+1|0]|0}function z(t){t=t|0;return n[t|0]<<24|n[t+1|0]<<16|n[t+2|0]<<8|n[t+3|0]|0}function Y(t){t=t|0;i(t|0);D=D+1|0;return 0}function W(t){t=t|0;if(K(1)|0){return 1}i(n[D+1|0]|0);D=D+2|0;return 0}function q(t){t=t|0;if(K(2)|0){return 1}i($(D+1|0)|0);D=D+3|0;return 0}function V(t){t=t|0;if(K(4)|0){return 1}s($(D+1|0)|0,$(D+3|0)|0);D=D+5|0;return 0}function X(t){t=t|0;if(K(8)|0){return 1}o($(D+1|0)|0,$(D+3|0)|0,$(D+5|0)|0,$(D+7|0)|0);D=D+9|0;return 0}function J(t){t=t|0;i(-1-(t-32|0)|0);D=D+1|0;return 0}function Z(t){t=t|0;if(K(1)|0){return 1}i(-1-(n[D+1|0]|0)|0);D=D+2|0;return 0}function Q(t){t=t|0;var e=0;if(K(2)|0){return 1}e=$(D+1|0)|0;i(-1-(e|0)|0);D=D+3|0;return 0}function tt(t){t=t|0;if(K(4)|0){return 1}u($(D+1|0)|0,$(D+3|0)|0);D=D+5|0;return 0}function et(t){t=t|0;if(K(8)|0){return 1}a($(D+1|0)|0,$(D+3|0)|0,$(D+5|0)|0,$(D+7|0)|0);D=D+9|0;return 0}function rt(t){t=t|0;var e=0;var r=0;var n=0;n=t-64|0;if(K(n|0)|0){return 1}e=D+1|0;r=(D+1|0)+(n|0)|0;T(e|0,r|0);D=r|0;return 0}function nt(t){t=t|0;var e=0;var r=0;var i=0;if(K(1)|0){return 1}i=n[D+1|0]|0;e=D+2|0;r=(D+2|0)+(i|0)|0;if(K(i+1|0)|0){return 1}T(e|0,r|0);D=r|0;return 0}function it(t){t=t|0;var e=0;var r=0;var n=0;if(K(2)|0){return 1}n=$(D+1|0)|0;e=D+3|0;r=(D+3|0)+(n|0)|0;if(K(n+2|0)|0){return 1}T(e|0,r|0);D=r|0;return 0}function st(t){t=t|0;var e=0;var r=0;var n=0;if(K(4)|0){return 1}n=z(D+1|0)|0;e=D+5|0;r=(D+5|0)+(n|0)|0;if(K(n+4|0)|0){return 1}T(e|0,r|0);D=r|0;return 0}function ut(t){t=t|0;return 1}function ot(t){t=t|0;U();D=D+1|0;return 0}function at(t){t=t|0;var e=0;var r=0;var n=0;n=t-96|0;if(K(n|0)|0){return 1}e=D+1|0;r=(D+1|0)+(n|0)|0;O(e|0,r|0);D=r|0;return 0}function ft(t){t=t|0;var e=0;var r=0;var i=0;if(K(1)|0){return 1}i=n[D+1|0]|0;e=D+2|0;r=(D+2|0)+(i|0)|0;if(K(i+1|0)|0){return 1}O(e|0,r|0);D=r|0;return 0}function ht(t){t=t|0;var e=0;var r=0;var n=0;if(K(2)|0){return 1}n=$(D+1|0)|0;e=D+3|0;r=(D+3|0)+(n|0)|0;if(K(n+2|0)|0){return 1}O(e|0,r|0);D=r|0;return 0}function ct(t){t=t|0;var e=0;var r=0;var n=0;if(K(4)|0){return 1}n=z(D+1|0)|0;e=D+5|0;r=(D+5|0)+(n|0)|0;if(K(n+4|0)|0){return 1}O(e|0,r|0);D=r|0;return 0}function pt(t){t=t|0;return 1}function lt(t){t=t|0;R();D=D+1|0;return 0}function yt(t){t=t|0;A(t-128|0);D=D+1|0;return 0}function gt(t){t=t|0;if(K(1)|0){return 1}A(n[D+1|0]|0);D=D+2|0;return 0}function dt(t){t=t|0;if(K(2)|0){return 1}A($(D+1|0)|0);D=D+3|0;return 0}function mt(t){t=t|0;if(K(4)|0){return 1}E($(D+1|0)|0,$(D+3|0)|0);D=D+5|0;return 0}function wt(t){t=t|0;if(K(8)|0){return 1}B($(D+1|0)|0,$(D+3|0)|0,$(D+5|0)|0,$(D+7|0)|0);D=D+9|0;return 0}function bt(t){t=t|0;v();D=D+1|0;return 0}function vt(t){t=t|0;var e=0;e=t-160|0;if(K(e|0)|0){return 1}_(e|0);D=D+1|0;return 0}function At(t){t=t|0;if(K(1)|0){return 1}_(n[D+1|0]|0);D=D+2|0;return 0}function Et(t){t=t|0;if(K(2)|0){return 1}_($(D+1|0)|0);D=D+3|0;return 0}function Bt(t){t=t|0;if(K(4)|0){return 1}I($(D+1|0)|0,$(D+3|0)|0);D=D+5|0;return 0}function St(t){t=t|0;if(K(8)|0){return 1}N($(D+1|0)|0,$(D+3|0)|0,$(D+5|0)|0,$(D+7|0)|0);D=D+9|0;return 0}function _t(t){t=t|0;S();D=D+1|0;return 0}function It(t){t=t|0;M(t-192|0|0);D=D+1|0;return 0}function Nt(t){t|0;M(t|0);D=D+1|0;return 0}function Tt(t){t|0;M(t|0);D=D+1|0;return 0}function Ut(t){t|0;M(t|0);D=D+1|0;return 0}function Ot(t){t|0;M(t|0);D=D+1|0;return 0}function Rt(t){t=t|0;M(t-192|0|0);D=D+1|0;return 0}function Pt(t){t|0;M(t|0);D=D+1|0;return 0}function Mt(t){t|0;M(t|0);D=D+1|0;return 0}function Ft(t){t|0;M(t|0);D=D+1|0;return 0}function Ct(t){t=t|0;if(K(1)|0){return 1}M(n[D+1|0]|0);D=D+2|0;return 0}function Lt(t){t=t|0;if(K(2)|0){return 1}M($(D+1|0)|0);D=D+3|0;return 0}function kt(t){t=t|0;if(K(4)|0){return 1}F($(D+1|0)|0,$(D+3|0)|0);D=D+5|0;return 0}function xt(t){t=t|0;if(K(8)|0){return 1}C($(D+1|0)|0,$(D+3|0)|0,$(D+5|0)|0,$(D+7|0)|0);D=D+9|0;return 0}function Dt(t){t=t|0;P((t|0)-224|0);D=D+1|0;return 0}function jt(t){t=t|0;l();D=D+1|0;return 0}function Ht(t){t=t|0;p();D=D+1|0;return 0}function Gt(t){t=t|0;g();D=D+1|0;return 0}function Kt(t){t=t|0;y();D=D+1|0;return 0}function $t(t){t=t|0;if(K(1)|0){return 1}P(n[D+1|0]|0);D=D+2|0;return 0}function zt(t){t=t|0;var e=0;var r=0;var i=1.0;var s=0.0;var u=0.0;var o=0.0;if(K(2)|0){return 1}e=n[D+1|0]|0;r=n[D+2|0]|0;if((e|0)&0x80){i=-1.0}s=+(((e|0)&0x7C)>>2);u=+(((e|0)&0x03)<<8|r);if(+s==0.0){f(+(+i*+5.9604644775390625e-8*+u))}else if(+s==31.0){if(+i==1.0){if(+u>0.0){w()}else{d()}}else{if(+u>0.0){b()}else{m()}}}else{f(+(+i*x(+2,+(+s-25.0))*+(1024.0+u)))}D=D+3|0;return 0}function Yt(t){t=t|0;if(K(4)|0){return 1}h(n[D+1|0]|0,n[D+2|0]|0,n[D+3|0]|0,n[D+4|0]|0);D=D+5|0;return 0}function Wt(t){t=t|0;if(K(8)|0){return 1}c(n[D+1|0]|0,n[D+2|0]|0,n[D+3|0]|0,n[D+4|0]|0,n[D+5|0]|0,n[D+6|0]|0,n[D+7|0]|0,n[D+8|0]|0);D=D+9|0;return 0}function qt(t){t=t|0;return 1}function Vt(t){t=t|0;k();D=D+1|0;return 0}var Xt=[Y,Y,Y,Y,Y,Y,Y,Y,Y,Y,Y,Y,Y,Y,Y,Y,Y,Y,Y,Y,Y,Y,Y,Y,W,q,V,X,qt,qt,qt,qt,J,J,J,J,J,J,J,J,J,J,J,J,J,J,J,J,J,J,J,J,J,J,J,J,Z,Q,tt,et,qt,qt,qt,qt,rt,rt,rt,rt,rt,rt,rt,rt,rt,rt,rt,rt,rt,rt,rt,rt,rt,rt,rt,rt,rt,rt,rt,rt,nt,it,st,ut,qt,qt,qt,ot,at,at,at,at,at,at,at,at,at,at,at,at,at,at,at,at,at,at,at,at,at,at,at,at,ft,ht,ct,pt,qt,qt,qt,lt,yt,yt,yt,yt,yt,yt,yt,yt,yt,yt,yt,yt,yt,yt,yt,yt,yt,yt,yt,yt,yt,yt,yt,yt,gt,dt,mt,wt,qt,qt,qt,bt,vt,vt,vt,vt,vt,vt,vt,vt,vt,vt,vt,vt,vt,vt,vt,vt,vt,vt,vt,vt,vt,vt,vt,vt,At,Et,Bt,St,qt,qt,qt,_t,It,It,It,It,It,It,Rt,Rt,Rt,Rt,Rt,Rt,Rt,Rt,Rt,Rt,Rt,Rt,Rt,Rt,Rt,Rt,Rt,Rt,Ct,Lt,kt,xt,qt,qt,qt,qt,Dt,Dt,Dt,Dt,Dt,Dt,Dt,Dt,Dt,Dt,Dt,Dt,Dt,Dt,Dt,Dt,Dt,Dt,Dt,Dt,jt,Ht,Gt,Kt,$t,zt,Yt,Wt,qt,qt,qt,Vt];return{parse:G}}(s,{log:console.log.bind(console),pushInt:this.pushInt.bind(this),pushInt32:this.pushInt32.bind(this),pushInt32Neg:this.pushInt32Neg.bind(this),pushInt64:this.pushInt64.bind(this),pushInt64Neg:this.pushInt64Neg.bind(this),pushFloat:this.pushFloat.bind(this),pushFloatSingle:this.pushFloatSingle.bind(this),pushFloatDouble:this.pushFloatDouble.bind(this),pushTrue:this.pushTrue.bind(this),pushFalse:this.pushFalse.bind(this),pushUndefined:this.pushUndefined.bind(this),pushNull:this.pushNull.bind(this),pushInfinity:this.pushInfinity.bind(this),pushInfinityNeg:this.pushInfinityNeg.bind(this),pushNaN:this.pushNaN.bind(this),pushNaNNeg:this.pushNaNNeg.bind(this),pushArrayStart:this.pushArrayStart.bind(this),pushArrayStartFixed:this.pushArrayStartFixed.bind(this),pushArrayStartFixed32:this.pushArrayStartFixed32.bind(this),pushArrayStartFixed64:this.pushArrayStartFixed64.bind(this),pushObjectStart:this.pushObjectStart.bind(this),pushObjectStartFixed:this.pushObjectStartFixed.bind(this),pushObjectStartFixed32:this.pushObjectStartFixed32.bind(this),pushObjectStartFixed64:this.pushObjectStartFixed64.bind(this),pushByteString:this.pushByteString.bind(this),pushByteStringStart:this.pushByteStringStart.bind(this),pushUtf8String:this.pushUtf8String.bind(this),pushUtf8StringStart:this.pushUtf8StringStart.bind(this),pushSimpleUnassigned:this.pushSimpleUnassigned.bind(this),pushTagUnassigned:this.pushTagUnassigned.bind(this),pushTagStart:this.pushTagStart.bind(this),pushTagStart4:this.pushTagStart4.bind(this),pushTagStart8:this.pushTagStart8.bind(this),pushBreak:this.pushBreak.bind(this)},this._heap)}get _depth(){return this._parents.length}get _currentParent(){return this._parents[this._depth-1]}get _ref(){return this._currentParent.ref}_closeParent(){var t=this._parents.pop();if(t.length>0)throw new Error(`Missing ${t.length} elements`);switch(t.type){case S.PARENT.TAG:this._push(this.createTag(t.ref[0],t.ref[1]));break;case S.PARENT.BYTE_STRING:this._push(this.createByteString(t.ref,t.length));break;case S.PARENT.UTF8_STRING:this._push(this.createUtf8String(t.ref,t.length));break;case S.PARENT.MAP:if(t.values%2>0)throw new Error("Odd number of elements in the map");this._push(this.createMap(t.ref,t.length));break;case S.PARENT.OBJECT:if(t.values%2>0)throw new Error("Odd number of elements in the map");this._push(this.createObject(t.ref,t.length));break;case S.PARENT.ARRAY:this._push(this.createArray(t.ref,t.length))}this._currentParent&&this._currentParent.type===S.PARENT.TAG&&this._dec()}_dec(){const t=this._currentParent;t.length<0||(t.length--,0===t.length&&this._closeParent())}_push(t,e){const r=this._currentParent;switch(r.values++,r.type){case S.PARENT.ARRAY:case S.PARENT.BYTE_STRING:case S.PARENT.UTF8_STRING:r.length>-1?this._ref[this._ref.length-r.length]=t:this._ref.push(t),this._dec();break;case S.PARENT.OBJECT:null!=r.tmpKey?(this._ref[r.tmpKey]=t,r.tmpKey=null,this._dec()):(r.tmpKey=t,"string"!=typeof r.tmpKey&&(r.type=S.PARENT.MAP,r.ref=_.buildMap(r.ref)));break;case S.PARENT.MAP:null!=r.tmpKey?(this._ref.set(r.tmpKey,t),r.tmpKey=null,this._dec()):r.tmpKey=t;break;case S.PARENT.TAG:this._ref.push(t),e||this._dec();break;default:throw new Error("Unknown parent type")}}_createParent(t,e,r){this._parents[this._depth]={type:e,length:r,ref:t,values:0,tmpKey:null}}_reset(){this._res=[],this._parents=[{type:S.PARENT.ARRAY,length:-1,ref:this._res,values:0,tmpKey:null}]}createTag(t,e){const r=this._knownTags[t];return r?r(e):new O(t,e)}createMap(t,e){return t}createObject(t,e){return t}createArray(t,e){return t}createByteString(t,e){return H.concat(t)}createByteStringFromHeap(t,e){return t===e?H.alloc(0):H.from(this._heap.slice(t,e))}createInt(t){return t}createInt32(t,e){return _.buildInt32(t,e)}createInt64(t,e,r,n){return _.buildInt64(t,e,r,n)}createFloat(t){return t}createFloatSingle(t,e,r,n){return b([t,e,r,n],0,!1,23,4)}createFloatDouble(t,e,r,n,i,s,u,o){return b([t,e,r,n,i,s,u,o],0,!1,52,8)}createInt32Neg(t,e){return-1-_.buildInt32(t,e)}createInt64Neg(t,e,r,n){const i=_.buildInt32(t,e),s=_.buildInt32(r,n);return i>S.MAX_SAFE_HIGH?S.NEG_ONE.minus(new G(i).times(S.SHIFT32).plus(s)):-1-(i*S.SHIFT32+s)}createTrue(){return!0}createFalse(){return!1}createNull(){return null}createUndefined(){}createInfinity(){return 1/0}createInfinityNeg(){return-1/0}createNaN(){return NaN}createNaNNeg(){return NaN}createUtf8String(t,e){return t.join("")}createUtf8StringFromHeap(t,e){return t===e?"":this._buffer.toString("utf8",t,e)}createSimpleUnassigned(t){return new U(t)}pushInt(t){this._push(this.createInt(t))}pushInt32(t,e){this._push(this.createInt32(t,e))}pushInt64(t,e,r,n){this._push(this.createInt64(t,e,r,n))}pushFloat(t){this._push(this.createFloat(t))}pushFloatSingle(t,e,r,n){this._push(this.createFloatSingle(t,e,r,n))}pushFloatDouble(t,e,r,n,i,s,u,o){this._push(this.createFloatDouble(t,e,r,n,i,s,u,o))}pushInt32Neg(t,e){this._push(this.createInt32Neg(t,e))}pushInt64Neg(t,e,r,n){this._push(this.createInt64Neg(t,e,r,n))}pushTrue(){this._push(this.createTrue())}pushFalse(){this._push(this.createFalse())}pushNull(){this._push(this.createNull())}pushUndefined(){this._push(this.createUndefined())}pushInfinity(){this._push(this.createInfinity())}pushInfinityNeg(){this._push(this.createInfinityNeg())}pushNaN(){this._push(this.createNaN())}pushNaNNeg(){this._push(this.createNaNNeg())}pushArrayStart(){this._createParent([],S.PARENT.ARRAY,-1)}pushArrayStartFixed(t){this._createArrayStartFixed(t)}pushArrayStartFixed32(t,e){const r=_.buildInt32(t,e);this._createArrayStartFixed(r)}pushArrayStartFixed64(t,e,r,n){const i=_.buildInt64(t,e,r,n);this._createArrayStartFixed(i)}pushObjectStart(){this._createObjectStartFixed(-1)}pushObjectStartFixed(t){this._createObjectStartFixed(t)}pushObjectStartFixed32(t,e){const r=_.buildInt32(t,e);this._createObjectStartFixed(r)}pushObjectStartFixed64(t,e,r,n){const i=_.buildInt64(t,e,r,n);this._createObjectStartFixed(i)}pushByteStringStart(){this._parents[this._depth]={type:S.PARENT.BYTE_STRING,length:-1,ref:[],values:0,tmpKey:null}}pushByteString(t,e){this._push(this.createByteStringFromHeap(t,e))}pushUtf8StringStart(){this._parents[this._depth]={type:S.PARENT.UTF8_STRING,length:-1,ref:[],values:0,tmpKey:null}}pushUtf8String(t,e){this._push(this.createUtf8StringFromHeap(t,e))}pushSimpleUnassigned(t){this._push(this.createSimpleUnassigned(t))}pushTagStart(t){this._parents[this._depth]={type:S.PARENT.TAG,length:1,ref:[t]}}pushTagStart4(t,e){this.pushTagStart(_.buildInt32(t,e))}pushTagStart8(t,e,r,n){this.pushTagStart(_.buildInt64(t,e,r,n))}pushTagUnassigned(t){this._push(this.createTag(t))}pushBreak(){if(this._currentParent.length>-1)throw new Error("Unexpected break");this._closeParent()}_createObjectStartFixed(t){0!==t?this._createParent({},S.PARENT.OBJECT,t):this._push(this.createObject({}))}_createArrayStartFixed(t){0!==t?this._createParent(new Array(t),S.PARENT.ARRAY,t):this._push(this.createArray([]))}_decode(t){if(0===t.byteLength)throw new Error("Input too short");this._reset(),this._heap8.set(t);const e=this.parser.parse(t.byteLength);if(this._depth>1){for(;0===this._currentParent.length;)this._closeParent();if(this._depth>1)throw new Error("Undeterminated nesting")}if(e>0)throw new Error("Failed to parse");if(0===this._res.length)throw new Error("No valid result")}decodeFirst(t){return this._decode(t),this._res[0]}decodeAll(t){return this._decode(t),this._res}static decode(t,e){"string"==typeof t&&(t=H.from(t,e||"hex"));return new Decoder({size:t.length}).decodeFirst(t)}static decodeAll(t,e){"string"==typeof t&&(t=H.from(t,e||"hex"));return new Decoder({size:t.length}).decodeAll(t)}}Decoder.decodeFirst=Decoder.decode;var $=Decoder;const{Buffer:z}=A;class Diagnose extends ${createTag(t,e){return`${t}(${e})`}createInt(t){return super.createInt(t).toString()}createInt32(t,e){return super.createInt32(t,e).toString()}createInt64(t,e,r,n){return super.createInt64(t,e,r,n).toString()}createInt32Neg(t,e){return super.createInt32Neg(t,e).toString()}createInt64Neg(t,e,r,n){return super.createInt64Neg(t,e,r,n).toString()}createTrue(){return"true"}createFalse(){return"false"}createFloat(t){const e=super.createFloat(t);return _.isNegativeZero(t)?"-0_1":`${e}_1`}createFloatSingle(t,e,r,n){return`${super.createFloatSingle(t,e,r,n)}_2`}createFloatDouble(t,e,r,n,i,s,u,o){return`${super.createFloatDouble(t,e,r,n,i,s,u,o)}_3`}createByteString(t,e){const r=t.join(", ");return-1===e?`(_ ${r})`:`h'${r}`}createByteStringFromHeap(t,e){return`h'${z.from(super.createByteStringFromHeap(t,e)).toString("hex")}'`}createInfinity(){return"Infinity_1"}createInfinityNeg(){return"-Infinity_1"}createNaN(){return"NaN_1"}createNaNNeg(){return"-NaN_1"}createNull(){return"null"}createUndefined(){return"undefined"}createSimpleUnassigned(t){return`simple(${t})`}createArray(t,e){const r=super.createArray(t,e);return-1===e?`[_ ${r.join(", ")}]`:`[${r.join(", ")}]`}createMap(t,e){const r=super.createMap(t),n=Array.from(r.keys()).reduce(W(r),"");return-1===e?`{_ ${n}}`:`{${n}}`}createObject(t,e){const r=super.createObject(t),n=Object.keys(r).reduce(W(r),"");return-1===e?`{_ ${n}}`:`{${n}}`}createUtf8String(t,e){const r=t.join(", ");return-1===e?`(_ ${r})`:`"${r}"`}createUtf8StringFromHeap(t,e){return`"${z.from(super.createUtf8StringFromHeap(t,e)).toString("utf8")}"`}static diagnose(t,e){"string"==typeof t&&(t=z.from(t,e||"hex"));return(new Diagnose).decodeFirst(t)}}var Y=Diagnose;function W(t){return(e,r)=>e?`${e}, ${r}: ${t[r]}`:`${r}: ${t[r]}`}const{Buffer:q}=A,{URL:V}=j,X=E.BigNumber,J=S.MT,Z=S.NUMBYTES,Q=S.SHIFT32,tt=S.SYMS,et=S.TAG,rt=S.MT.SIMPLE_FLOAT<<5|S.NUMBYTES.TWO,nt=S.MT.SIMPLE_FLOAT<<5|S.NUMBYTES.FOUR,it=S.MT.SIMPLE_FLOAT<<5|S.NUMBYTES.EIGHT,st=S.MT.SIMPLE_FLOAT<<5|S.SIMPLE.TRUE,ut=S.MT.SIMPLE_FLOAT<<5|S.SIMPLE.FALSE,ot=S.MT.SIMPLE_FLOAT<<5|S.SIMPLE.UNDEFINED,at=S.MT.SIMPLE_FLOAT<<5|S.SIMPLE.NULL,ft=new X("0x20000000000000"),ht=q.from("f97e00","hex"),ct=q.from("f9fc00","hex"),pt=q.from("f97c00","hex");class Encoder{constructor(t){t=t||{},this.streaming="function"==typeof t.stream,this.onData=t.stream,this.semanticTypes=[[V,this._pushUrl],[X,this._pushBigNumber]];const e=t.genTypes||[],r=e.length;for(let t=0;t<r;t++)this.addSemanticType(e[t][0],e[t][1]);this._reset()}addSemanticType(t,e){const r=this.semanticTypes.length;for(let n=0;n<r;n++){if(this.semanticTypes[n][0]===t){const t=this.semanticTypes[n][1];return this.semanticTypes[n][1]=e,t}}return this.semanticTypes.push([t,e]),null}push(t){return!t||(this.result[this.offset]=t,this.resultMethod[this.offset]=0,this.resultLength[this.offset]=t.length,this.offset++,this.streaming&&this.onData(this.finalize()),!0)}pushWrite(t,e,r){return this.result[this.offset]=t,this.resultMethod[this.offset]=e,this.resultLength[this.offset]=r,this.offset++,this.streaming&&this.onData(this.finalize()),!0}_pushUInt8(t){return this.pushWrite(t,1,1)}_pushUInt16BE(t){return this.pushWrite(t,2,2)}_pushUInt32BE(t){return this.pushWrite(t,3,4)}_pushDoubleBE(t){return this.pushWrite(t,4,8)}_pushNaN(){return this.push(ht)}_pushInfinity(t){const e=t<0?ct:pt;return this.push(e)}_pushFloat(t){const e=q.allocUnsafe(2);if(_.writeHalf(e,t)&&_.parseHalf(e)===t)return this._pushUInt8(rt)&&this.push(e);const r=q.allocUnsafe(4);return r.writeFloatBE(t,0),r.readFloatBE(0)===t?this._pushUInt8(nt)&&this.push(r):this._pushUInt8(it)&&this._pushDoubleBE(t)}_pushInt(t,e,r){const n=e<<5;return t<24?this._pushUInt8(n|t):t<=255?this._pushUInt8(n|Z.ONE)&&this._pushUInt8(t):t<=65535?this._pushUInt8(n|Z.TWO)&&this._pushUInt16BE(t):t<=4294967295?this._pushUInt8(n|Z.FOUR)&&this._pushUInt32BE(t):t<=Number.MAX_SAFE_INTEGER?this._pushUInt8(n|Z.EIGHT)&&this._pushUInt32BE(Math.floor(t/Q))&&this._pushUInt32BE(t%Q):e===J.NEG_INT?this._pushFloat(r):this._pushFloat(t)}_pushIntNum(t){return t<0?this._pushInt(-t-1,J.NEG_INT,t):this._pushInt(t,J.POS_INT)}_pushNumber(t){switch(!1){case t==t:return this._pushNaN(t);case isFinite(t):return this._pushInfinity(t);case t%1!=0:return this._pushIntNum(t);default:return this._pushFloat(t)}}_pushString(t){const e=q.byteLength(t,"utf8");return this._pushInt(e,J.UTF8_STRING)&&this.pushWrite(t,5,e)}_pushBoolean(t){return this._pushUInt8(t?st:ut)}_pushUndefined(t){return this._pushUInt8(ot)}_pushArray(t,e){const r=e.length;if(!t._pushInt(r,J.ARRAY))return!1;for(let n=0;n<r;n++)if(!t.pushAny(e[n]))return!1;return!0}_pushTag(t){return this._pushInt(t,J.TAG)}_pushDate(t,e){return t._pushTag(et.DATE_EPOCH)&&t.pushAny(Math.round(e/1e3))}_pushBuffer(t,e){return t._pushInt(e.length,J.BYTE_STRING)&&t.push(e)}_pushNoFilter(t,e){return t._pushBuffer(t,e.slice())}_pushRegexp(t,e){return t._pushTag(et.REGEXP)&&t.pushAny(e.source)}_pushSet(t,e){if(!t._pushInt(e.size,J.ARRAY))return!1;for(const r of e)if(!t.pushAny(r))return!1;return!0}_pushUrl(t,e){return t._pushTag(et.URI)&&t.pushAny(e.format())}_pushBigint(t){let e=et.POS_BIGINT;t.isNegative()&&(t=t.negated().minus(1),e=et.NEG_BIGINT);let r=t.toString(16);r.length%2&&(r="0"+r);const n=q.from(r,"hex");return this._pushTag(e)&&this._pushBuffer(this,n)}_pushBigNumber(t,e){if(e.isNaN())return t._pushNaN();if(!e.isFinite())return t._pushInfinity(e.isNegative()?-1/0:1/0);if(e.isInteger())return t._pushBigint(e);if(!t._pushTag(et.DECIMAL_FRAC)||!t._pushInt(2,J.ARRAY))return!1;const r=e.decimalPlaces(),n=e.multipliedBy(new X(10).pow(r));return!!t._pushIntNum(-r)&&(n.abs().isLessThan(ft)?t._pushIntNum(n.toNumber()):t._pushBigint(n))}_pushMap(t,e){return!!t._pushInt(e.size,J.MAP)&&this._pushRawMap(e.size,Array.from(e))}_pushObject(t){if(!t)return this._pushUInt8(at);for(var e=this.semanticTypes.length,r=0;r<e;r++)if(t instanceof this.semanticTypes[r][0])return this.semanticTypes[r][1].call(t,this,t);var n=t.encodeCBOR;if("function"==typeof n)return n.call(t,this);var i=Object.keys(t),s=i.length;return!!this._pushInt(s,J.MAP)&&this._pushRawMap(s,i.map((e=>[e,t[e]])))}_pushRawMap(t,e){e=e.map((function(t){return t[0]=Encoder.encode(t[0]),t})).sort(_.keySorter);for(var r=0;r<t;r++){if(!this.push(e[r][0]))return!1;if(!this.pushAny(e[r][1]))return!1}return!0}write(t){return this.pushAny(t)}pushAny(t){switch(function(t){return{}.toString.call(t).slice(8,-1)}(t)){case"Number":return this._pushNumber(t);case"String":return this._pushString(t);case"Boolean":return this._pushBoolean(t);case"Object":return this._pushObject(t);case"Array":return this._pushArray(this,t);case"Uint8Array":return this._pushBuffer(this,q.isBuffer(t)?t:q.from(t));case"Null":return this._pushUInt8(at);case"Undefined":return this._pushUndefined(t);case"Map":return this._pushMap(this,t);case"Set":return this._pushSet(this,t);case"URL":return this._pushUrl(this,t);case"BigNumber":return this._pushBigNumber(this,t);case"Date":return this._pushDate(this,t);case"RegExp":return this._pushRegexp(this,t);case"Symbol":switch(t){case tt.NULL:return this._pushObject(null);case tt.UNDEFINED:return this._pushUndefined(void 0);default:throw new Error("Unknown symbol: "+t.toString())}default:throw new Error("Unknown type: "+typeof t+", "+(t?t.toString():""))}}finalize(){if(0===this.offset)return null;for(var t=this.result,e=this.resultLength,r=this.resultMethod,n=this.offset,i=0,s=0;s<n;s++)i+=e[s];var u=q.allocUnsafe(i),o=0,a=0;for(s=0;s<n;s++){switch(a=e[s],r[s]){case 0:t[s].copy(u,o);break;case 1:u.writeUInt8(t[s],o,!0);break;case 2:u.writeUInt16BE(t[s],o,!0);break;case 3:u.writeUInt32BE(t[s],o,!0);break;case 4:u.writeDoubleBE(t[s],o,!0);break;case 5:u.write(t[s],o,a,"utf8");break;default:throw new Error("unkown method")}o+=a}var f=u;return this._reset(),f}_reset(){this.result=[],this.resultMethod=[],this.resultLength=[],this.offset=0}static encode(t){const e=new Encoder;if(!e.pushAny(t))throw new Error("Failed to encode input");return e.finalize()}}var lt=Encoder,yt=u((function(t,e){e.Diagnose=Y,e.Decoder=$,e.Encoder=lt,e.Simple=U,e.Tagged=O,e.decodeAll=e.Decoder.decodeAll,e.decodeFirst=e.Decoder.decodeFirst,e.diagnose=e.Diagnose.diagnose,e.encode=e.Encoder.encode,e.decode=e.Decoder.decode,e.leveldb={decode:e.Decoder.decodeAll,encode:e.Encoder.encode,buffer:!0,name:"cbor"}}));var gt=function(t){var e=t.length,r=e%4;if(!r)return t;var n=e,i=4-r,s=e+i,u=A.Buffer.alloc(s);for(u.write(t);i--;)u.write("=",n++);return u.toString()},dt=Object.defineProperty({default:gt},"__esModule",{value:!0});function mt(t,e){return void 0===e&&(e="utf8"),A.Buffer.isBuffer(t)?bt(t.toString("base64")):bt(A.Buffer.from(t,e).toString("base64"))}function wt(t){return t=t.toString(),dt.default(t).replace(/\-/g,"+").replace(/_/g,"/")}function bt(t){return t.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}var vt=mt;vt.encode=mt,vt.decode=function(t,e){return void 0===e&&(e="utf8"),A.Buffer.from(wt(t),"base64").toString(e)},vt.toBase64=wt,vt.fromBase64=bt,vt.toBuffer=function(t){return A.Buffer.from(wt(t),"base64")};var At=vt,Et=Object.defineProperty({default:At},"__esModule",{value:!0}),Bt=u((function(t){t.exports=Et.default,t.exports.default=t.exports}));class Header{constructor(t={}){this.headers=t}static wrap(t){return new this(t)}unwrap(){return this.headers}}const St={"A128CBC-HS256":{keylen:32,hash:"SHA-256"},"A256CBC-HS512":{keylen:64,hash:"SHA-512"}},_t={async decrypt(t,e,r,{aad:n,iv:s,tag:u}){It(r,t);const{hash:o}=St[t],{e:a,m:f}=Nt(r),h=A.Buffer.from(n||""),c=await i.default.subtle.importKey("raw",a,"AES-CBC",!1,["decrypt"]),p=await i.default.subtle.importKey("raw",f,{name:"HMAC",hash:o},!1,["verify"]),l=Tt({additionalData:h,iv:s,encrypted:e});if(await i.default.subtle.verify("HMAC",p,u,l)){const t=await i.default.subtle.decrypt({name:"AES-CBC",iv:s},c,e);return A.Buffer.from(t)}throw"HMAC validation failed"},async encrypt(t,e,r,n={}){It(r,t);const{hash:s}=St[t],{e:u,m:o}=Nt(r),a=n.iv?n.iv:i.default.getRandomValues(new Uint8Array(16)),f=A.Buffer.from(n.aad?n.aad:""),h=await i.default.subtle.importKey("raw",u,"AES-CBC",!1,["encrypt"]),c=await i.default.subtle.importKey("raw",o,{name:"HMAC",hash:s},!1,["sign"]),p=await i.default.subtle.encrypt({name:"AES-CBC",iv:a},h,A.Buffer.from(e)),l=Tt({additionalData:f,iv:a,encrypted:p}),y=await i.default.subtle.sign("HMAC",c,l);return{encrypted:A.Buffer.from(p),iv:A.Buffer.from(a),tag:A.Buffer.from(y)}}};function It(t,e){const{keylen:r}=St[e];if("oct"!==t.type||t.params.k.length!==r)throw`Invalid key for ${e} algorithm`}function Nt(t){const e=t.params.k.length/2,r=t.params.k.slice(0,e);return{e:t.params.k.slice(e),m:r}}function Tt({additionalData:t,iv:e,encrypted:r}){const n=A.Buffer.alloc(8,0);return n.writeUInt32BE(t.length>>8,0),n.writeUInt32BE(255&t.length,4),A.Buffer.concat([t,A.Buffer.from(e),A.Buffer.from(r),n])}const Ut={A128GCM:{keylen:16},A256GCM:{keylen:32}},Ot={async decrypt(t,e,r,{aad:n,iv:s,tag:u}){Rt(r,t),e=A.Buffer.concat([A.Buffer.from(e),A.Buffer.from(u)]);const o=A.Buffer.from(n||""),a=await i.default.subtle.importKey("raw",r.params.k,"AES-GCM",!1,["decrypt"]),f=await i.default.subtle.decrypt({name:"AES-GCM",iv:s,additionalData:o},a,e);return A.Buffer.from(f)},async encrypt(t,e,r,n={}){Rt(r,t);const s=n.iv?n.iv:i.default.getRandomValues(new Uint8Array(12)),u=A.Buffer.from(n.aad?n.aad:""),o=await i.default.subtle.importKey("raw",r.params.k,"AES-GCM",!1,["encrypt"]),a=await i.default.subtle.encrypt({name:"AES-GCM",iv:s,additionalData:u},o,A.Buffer.from(e));return{encrypted:A.Buffer.from(a).slice(0,-16),iv:A.Buffer.from(s),tag:A.Buffer.from(a).slice(-16)}}};function Rt(t,e){const{keylen:r}=Ut[e];if("oct"!==t.type||t.params.k.length!==r)throw`Invalid key for ${e} algorithm`}const Pt={"ECDH-ES+A128GCM":{enc:"A128GCM",keylen:16},"ECDH-ES+A256GCM":{enc:"A256GCM",keylen:32}},Mt={async decrypt(t,r,n,i={}){Ft(n,t);const{enc:s}=Pt[t],u=e.PubKey.fromBuffer(i.epk),o=new Key("ec",{crv:"secp256k1",x:A.Buffer.from(u.point.x.toArray("big",32)),y:A.Buffer.from(u.point.y.toArray("big",32))}),a=await Lt(Ct(n,o),t,i);return Ot.decrypt(s,r,new Key("oct",{k:a}),i)},async encrypt(t,e,r,n={}){Ft(r,t);const{enc:i}=Pt[t],s=await Key.generate("ec","secp256k1"),u=await Lt(Ct(s,r),t,n);return{...await Ot.encrypt(i,e,new Key("oct",{k:u}),n),epk:kt(s)}}};function Ft(t,e){if("EC"!==t.type||"secp256k1"!==t.params.crv)throw`Invalid key for ${e} algorithm`}function Ct(t,r){const n=e.Bn.fromBuffer(r.params.x),i=e.Bn.fromBuffer(r.params.y),s=e.Bn.fromBuffer(t.params.d),u=new e.Point(n,i).mul(s);return A.Buffer.from(u.x.toArray("big",32))}async function Lt(t,e,r){const{keylen:n}=Pt[e],s=A.Buffer.from(e),u=A.Buffer.from(r.apu?r.apu:""),o=A.Buffer.from(r.apv?r.apv:""),a=A.Buffer.alloc(4),f=A.Buffer.alloc(4),h=A.Buffer.alloc(4),c=A.Buffer.alloc(4);a.writeUInt32BE(8*n),f.writeUInt32BE(s.length),h.writeUInt32BE(u.length),c.writeUInt32BE(o.length);const p=A.Buffer.concat([t,a,f,s,h,u,c,o,A.Buffer.from("")]),l=await i.default.subtle.digest("SHA-256",p);return A.Buffer.from(l).slice(0,n)}function kt(t){const r=e.Bn.fromBuffer(t.params.x),n=e.Bn.fromBuffer(t.params.y),i=new e.Point(r,n);return new e.PubKey(i).toBuffer()}function xt(t){return new Key("EC",{crv:"secp256k1",x:A.Buffer.from(t.point.x.toArray("big",32)),y:A.Buffer.from(t.point.y.toArray("big",32))})}function Dt(t){const r=e.Bn.fromBuffer(A.Buffer.from(t.params.x)),n=e.Bn.fromBuffer(A.Buffer.from(t.params.y));return new e.PubKey(new e.Point(r,n))}function jt(t){const r=e.Bn.fromBuffer(A.Buffer.from(t.params.d));return e.PrivKey.fromBn(r)}var Ht=Object.freeze({__proto__:null,fromBsvPubKey:xt,fromBsvPrivKey:function(t){const{pubKey:r}=e.KeyPair.fromPrivKey(t);return new Key("EC",{crv:"secp256k1",d:A.Buffer.from(t.bn.toArray("big",32)),x:A.Buffer.from(r.point.x.toArray("big",32)),y:A.Buffer.from(r.point.y.toArray("big",32))})},toBsvPubKey:Dt,toBsvPrivKey:jt});function Gt(t,e){if("EC"!==t.type||"secp256k1"!==t.params.crv)throw"Invalid key for ECIES-BIE1 algorithm"}function Kt(t,r){const n=e.Bn.fromBuffer(r.params.x),i=e.Bn.fromBuffer(r.params.y),s=e.Bn.fromBuffer(t.params.d),u=new e.Point(n,i).mul(s);return A.Buffer.concat([A.Buffer.from([u.y.isOdd()?3:2]),A.Buffer.from(u.x.toArray("big",32))])}function $t(t){const r=e.Bn.fromBuffer(t.params.x),n=e.Bn.fromBuffer(t.params.y),i=new e.Point(r,n);return new e.PubKey(i).toBuffer()}function zt(t,e){if("EC"!==t.type||"secp256k1"!==t.params.crv)throw"Invalid key for ES256K algorithm"}function Yt(t){const r=A.Buffer.from("Bitcoin Signed Message:\n"),n=A.Buffer.from(t),i=A.Buffer.concat([e.Bw.varIntBufNum(r.length),r,e.Bw.varIntBufNum(n.length),n]);return e.Hash.sha256Sha256(i)}function Wt(t,e){if("EC"!==t.type||"secp256k1"!==t.params.crv)throw"Invalid key for ES256K-BSM algorithm"}const qt={HS256:{hash:"SHA-256"},HS512:{hash:"SHA-512"}},Vt={async sign(t,e,r){Xt(r,t);const{hash:n}=qt[t],s=await i.default.subtle.importKey("raw",r.params.k,{name:"HMAC",hash:n},!1,["sign"]),u=await i.default.subtle.sign("HMAC",s,A.Buffer.from(e));return A.Buffer.from(u)},async verify(t,e,r,n){Xt(n,t);const{hash:s}=qt[t],u=await i.default.subtle.importKey("raw",n.params.k,{name:"HMAC",hash:s},!1,["verify"]);return i.default.subtle.verify("HMAC",u,r,A.Buffer.from(e))}};function Xt(t,e){if("oct"!==t.type)throw`Invalid key for ${e} algorithm`}const Jt={"A128CBC-HS256":_t,"A256CBC-HS512":_t,A128GCM:Ot,A256GCM:Ot,"ECDH-ES+A128GCM":Mt,"ECDH-ES+A256GCM":Mt,"ECIES-BIE1":{async decrypt(t,r,n,s={}){Gt(n);const u=r.length-69,o=r.slice(0,4),a=r.slice(4,37),f=r.slice(37,37+u),h=r.slice(37+u);if("BIE1"!==o.toString())throw"invalid magic bytes";const c=xt(e.PubKey.fromDer(a)),p=await i.default.subtle.digest("SHA-512",Kt(n,c)),l=p.slice(0,16),y=p.slice(16,32),g=p.slice(32),d=await i.default.subtle.importKey("raw",g,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);if(!await i.default.subtle.verify({name:"HMAC"},d,h,r.slice(0,-32)))throw"mac validation failed";const m=await i.default.subtle.importKey("raw",y,"AES-CBC",!1,["decrypt"]),w=await i.default.subtle.decrypt({name:"AES-CBC",iv:l},m,f);return A.Buffer.from(w)},async encrypt(t,e,r,n={}){Gt(r);const s=await Key.generate("ec","secp256k1"),u=await i.default.subtle.digest("SHA-512",Kt(s,r)),o=u.slice(0,16),a=u.slice(16,32),f=u.slice(32),h=await i.default.subtle.importKey("raw",a,"AES-CBC",!1,["encrypt"]),c=await i.default.subtle.encrypt({name:"AES-CBC",iv:o},h,A.Buffer.from(e)),p=await i.default.subtle.importKey("raw",f,{name:"HMAC",hash:"SHA-256"},!1,["sign"]),l=A.Buffer.concat([A.Buffer.from("BIE1"),$t(s),A.Buffer.from(c)]),y=await i.default.subtle.sign({name:"HMAC"},p,l);return{encrypted:A.Buffer.concat([l,A.Buffer.from(y)])}}},ES256K:{async sign(t,r,n){zt(n);const i=e.Hash.sha256(A.Buffer.from(r)),s=e.KeyPair.fromPrivKey(jt(n));return(new e.Ecdsa).fromObject({hashBuf:i,keyPair:s}).sign().calcrecovery().sig.toCompact()},async verify(t,r,n,i){zt(i);const s=e.Hash.sha256(A.Buffer.from(r)),u=(new e.Sig).fromCompact(A.Buffer.from(n)),o=new e.KeyPair;o.pubKey=Dt(i);const a=(new e.Ecdsa).fromObject({hashBuf:s,sig:u,keyPair:o});return a.verify(),a.verified}},"ES256K-BSM":{async sign(t,r,n){Wt(n);const i=Yt(r),s=e.KeyPair.fromPrivKey(jt(n));return(new e.Ecdsa).fromObject({hashBuf:i,keyPair:s}).sign().calcrecovery().sig.toCompact()},async verify(t,r,n,i){Wt(i);const s=Yt(r),u=(new e.Sig).fromCompact(A.Buffer.from(n)),o=new e.KeyPair;o.pubKey=Dt(i);const a=(new e.Ecdsa).fromObject({hashBuf:s,sig:u,keyPair:o});return a.verify(),a.verified}},HS256:Vt,HS512:Vt,get(t){if(this[t])return this[t];throw`Unsupported algorithm: ${t}`}};var Zt={decrypt:async(t,...e)=>Jt.get(t).decrypt(t,...e),encrypt:async(t,...e)=>Jt.get(t).encrypt(t,...e),sign:async(t,...e)=>Jt.get(t).sign(t,...e),verify:async(t,...e)=>Jt.get(t).verify(t,...e)};class Key{constructor(t,e){this.type=t,this.params=e}static decode(t){const{kty:e,...r}=yt.decode(t);return new this(e,r)}static async generate(t,r){if("ec"===t.toLowerCase()&&"secp256k1"===r){const t=e.KeyPair.fromRandom();return new this("EC",{crv:"secp256k1",d:A.Buffer.from(t.privKey.bn.toArray("big",32)),x:A.Buffer.from(t.pubKey.point.x.toArray("big",32)),y:A.Buffer.from(t.pubKey.point.y.toArray("big",32))})}if("oct"==t.toLowerCase()&&[128,256,512].includes(r)){const t=await i.default.subtle.generateKey({name:"AES-GCM",length:r},!0,["encrypt","decrypt"]),e=await i.default.subtle.exportKey("raw",t);return new this("oct",{k:A.Buffer.from(e)})}throw"Invalid key type or param"}async encrypt(t,e={},r={}){const{alg:n}=e,i={...r,...["iv"].reduce(((t,r)=>(t[r]=e[r],t)),{})},{encrypted:s,...u}=await Zt.encrypt(n,this.toBuffer(),t,i);return Recipient.wrap(s,{...e,...u})}toBuffer(){return yt.encode(this.toObject())}toObject(){return{...this.params,kty:this.type}}toPublic(){if("EC"===this.type){const{crv:t,x:e,y:r}=this.params;return new this.constructor("EC",{crv:t,x:e,y:r})}throw`Cannot convert key type '${this.type}' to public key`}}class Recipient{constructor({headers:t,key:e}){this.header=Header.wrap(t),this.key=e}static fromArray(t){return 2===t.length&&"object"==typeof t[0]&&"string"==typeof t[0].alg?new this({headers:t[0],key:t[1]}):t.map((t=>this.fromArray(t)))}static wrap(t,e={}){return new this({headers:e,key:t})}async decrypt(t,e={}){const{alg:r}=this.header.headers,n={...e,...["epk","iv","tag"].reduce(((t,e)=>(t[e]=this.header.headers[e],t)),{})},i=await Zt.decrypt(r,this.key,t,n);return this.key=Key.decode(i),this}toArray(){return[this.header.unwrap(),this.key]}}class Signature{constructor({headers:t,signature:e}){this.header=Header.wrap(t),this.signature=e}static fromArray(t){return 2===t.length&&"object"==typeof t[0]&&"string"==typeof t[0].alg?new this({headers:t[0],signature:t[1]}):t.map((t=>this.fromArray(t)))}static wrap(t,e={}){return new this({headers:e,signature:t})}toArray(){return[this.header.unwrap(),this.signature]}}const Qt="UNIV";function te(t,e){return Array.isArray(t)&&2===t.length?[t[0],{...e,...t[1]}]:[t,e]}return t.Envelope=class Envelope{constructor({headers:t,payload:e,signature:r,recipient:n}){this.header=Header.wrap(t),this.payload=e,this.signature=r,this.recipient=n}static fromArray(t){return new this({headers:t[0],payload:t[1],signature:Array.isArray(t[2])?Signature.fromArray(t[2]):void 0,recipient:Array.isArray(t[3])?Recipient.fromArray(t[3]):void 0})}static fromBuffer(t){return this.fromArray(yt.decode(t))}static fromScript(t){const e=t.chunks.findIndex(((t,e,r)=>106===t.opCodeNum&&r[e+1].buf&&r[e+1].buf.toString()===Qt));if(e>=0){const r=t.chunks.slice(e+2).map((t=>yt.decode(t.buf)));return this.fromArray(r)}throw"Invalid Univrse script"}static fromString(t){const e=t.split(".").map((t=>{const e=Bt.toBuffer(t);return yt.decode(e)}));return this.fromArray(e)}static wrap(t,e={}){return new this({headers:e,payload:t})}get encodedPayload(){return yt.encode(this.payload)}set encodedPayload(t){this.payload=yt.decode(t)}async decrypt(t,e={}){const r=Array.isArray(this.recipient)?this.recipient[0].header:this.recipient.header,{alg:n}=r.headers,i=yt.encode(["enc",this.header.unwrap(),e.aad?e.aad:""]),s={...e,...["epk","iv","tag"].reduce(((t,e)=>(t[e]=r.headers[e],t)),{}),aad:i};return this.encodedPayload=await Zt.decrypt(n,this.payload,t,s),this}async decryptAt(t,e,r={}){if(!Array.isArray(this.recipient)||this.recipient.length<=t)throw"Invalid recipient index";return await this.recipient[t].decrypt(e,r),this.decrypt(this.recipient[t].key,r)}async encrypt(t,e={},r={}){if(Array.isArray(t)){const[n,i]=te(t[0],e);let s,u,o;await this.encrypt(n,i);for(let i=1;i<t.length;i++)[s,u]=te(t[i],e),o=await n.encrypt(s,u,r),this.pushRecipient(o);return this}const{alg:n}=e,i=yt.encode(["enc",this.header.unwrap(),r.aad?r.aad:""]),s={...r,...["iv"].reduce(((t,r)=>(t[r]=e[r],t)),{}),aad:i},{encrypted:u,...o}=await Zt.encrypt(n,this.encodedPayload,t,s);this.payload=u;const a=Recipient.wrap(null,{...e,...o});return this.pushRecipient(a)}pushRecipient(t){return Array.isArray(this.recipient)?this.recipient.push(t):this.recipient?this.recipient=[this.recipient,t]:this.recipient=t,this}pushSignature(t){return Array.isArray(this.signature)?this.signature.push(t):this.signature?this.signature=[this.signature,t]:this.signature=t,this}async sign(t,e={}){if(Array.isArray(t)){for(let r=0;r<t.length;r++)Array.isArray(t[r])&&2===t[r].length?await this.sign(t[r][0],{...e,...t[r][1]}):await this.sign(t[r],e);return this}const r={...this.header.headers,...e}.alg,n=yt.encode(this.toArray().slice(0,2)),i=await Zt.sign(r,n,t);return this.pushSignature(Signature.wrap(i,e))}toArray(){const t=[this.header.unwrap(),this.payload];return Array.isArray(this.signature)?t.push(this.signature.map((t=>t.toArray()))):this.signature&&"function"==typeof this.signature.toArray?t.push(this.signature.toArray()):this.recipient&&t.push(null),Array.isArray(this.recipient)?t.push(this.recipient.map((t=>t.toArray()))):this.recipient&&"function"==typeof this.recipient.toArray&&t.push(this.recipient.toArray()),t}toBuffer(){return yt.encode(this.toArray())}toScript(t=!0){const r=new e.Script;return t&&r.writeOpCode(e.OpCode.OP_FALSE),r.writeOpCode(e.OpCode.OP_RETURN),r.writeBuffer(A.Buffer.from(Qt)),this.toArray().reduce(((t,e)=>t.writeBuffer(yt.encode(e))),r)}toString(){return this.toArray().map((t=>Bt.encode(yt.encode(t)))).join(".")}async verify(t,e){if(!e&&Array.isArray(t)&&Array.isArray(this.signature)&&t.length===this.signature.length){const e=t.map(((t,e)=>this.verify(t,e)));return(await Promise.all(e)).every((t=>!0===t))}let r=this.signature;Number.isInteger(e)&&Array.isArray(this.signature)&&(r=this.signature[e]);const n={...this.header.headers,...r.header.headers}.alg,i=yt.encode(this.toArray().slice(0,2));return Zt.verify(n,i,r.signature,t)}},t.Header=Header,t.Key=Key,t.Recipient=Recipient,t.Signature=Signature,t.util=Ht,t.version="0.2.0",Object.defineProperty(t,"__esModule",{value:!0}),t}({},bsvjs);